<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>HTTP Session â€“ </title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="github-pandoc.css">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../../laravel-docs/site.js"></script>
</head>
<body>
<aside><h1>Laravel 5.3 offline docs</h1><ul id="navigation">
<li><a href="application-testing.html">Application Testing</a>
<li><a href="artisan.html">Console Commands</a>
<li><a href="authentication.html">Authentication</a>
<li><a href="authorization.html">Authorization</a>
<li><a href="billing.html">Laravel Cashier</a>
<li><a href="blade.html">Blade Templates</a>
<li><a href="broadcasting.html">Event Broadcasting</a>
<li><a href="cache.html">Cache</a>
<li><a href="collections.html">Collections</a>
<li><a href="configuration.html">Configuration</a>
<li><a href="container.html">Service Container</a>
<li><a href="contracts.html">Contracts</a>
<li><a href="contributing.html">Contribution Guidelines</a>
<li><a href="contributions.html">Contribution Guide</a>
<li><a href="controllers.html">Controllers</a>
<li><a href="csrf.html">CSRF Protection</a>
<li><a href="database-testing.html">Database Testing</a>
<li><a href="database.html">Database: Getting Started</a>
<li><a href="documentation.html">Prologue</a>
<li><a href="elixir.html">Compiling Assets (Laravel Elixir)</a>
<li><a href="eloquent-collections.html">Eloquent: Collections</a>
<li><a href="eloquent-mutators.html">Eloquent: Mutators</a>
<li><a href="eloquent-relationships.html">Eloquent: Relationships</a>
<li><a href="eloquent-serialization.html">Eloquent: Serialization</a>
<li><a href="eloquent.html">Eloquent: Getting Started</a>
<li><a href="encryption.html">Encryption</a>
<li><a href="envoy.html">Envoy Task Runner</a>
<li><a href="errors.html">Errors & Logging</a>
<li><a href="events.html">Events
</a>
<li><a href="facades.html">Facades</a>
<li><a href="filesystem.html">Filesystem / Cloud Storage</a>
<li><a href="frontend.html">JavaScript & CSS</a>
<li><a href="hashing.html">Hashing</a>
<li><a href="helpers.html">Helper Functions</a>
<li><a href="homestead.html">Laravel Homestead</a>
<li><a href="installation.html">Installation</a>
<li><a href="lifecycle.html">Request Lifecycle</a>
<li><a href="localization.html">Localization</a>
<li><a href="mail.html">Mail
</a>
<li><a href="middleware.html">Middleware</a>
<li><a href="migrations.html">Database: Migrations</a>
<li><a href="mocking.html">Mocking</a>
<li><a href="notifications.html">Notifications</a>
<li><a href="packages.html">Package Development</a>
<li><a href="pagination.html">Pagination</a>
<li><a href="passport.html">API Authentication (Passport)</a>
<li><a href="passwords.html">Resetting Passwords</a>
<li><a href="providers.html">Service Providers</a>
<li><a href="queries.html">Database: Query Builder</a>
<li><a href="queues.html">Queues</a>
<li><a href="readme.html">Laravel Documentation</a>
<li><a href="redirects.html">HTTP Redirects</a>
<li><a href="redis.html">Redis</a>
<li><a href="releases.html">Release Notes</a>
<li><a href="requests.html">HTTP Requests</a>
<li><a href="responses.html">HTTP Responses</a>
<li><a href="routing.html">Routing</a>
<li><a href="scheduling.html">Task Scheduling</a>
<li><a href="scout.html">Laravel Scout</a>
<li><a href="seeding.html">Database: Seeding</a>
<li><a href="session.html">HTTP Session</a>
<li><a href="structure.html">Directory Structure</a>
<li><a href="testing.html">Testing</a>
<li><a href="upgrade.html">Upgrade Guide</a>
<li><a href="valet.html">Laravel Valet</a>
<li><a href="validation.html">Validation
</a>
<li><a href="views.html">Views</a>
</ul></aside><article>
<h1 id="http-session">HTTP Session</h1>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#driver-prerequisites">Driver Prerequisites</a></li>
</ul></li>
<li><a href="#using-the-session">Using The Session</a>
<ul>
<li><a href="#retrieving-data">Retrieving Data</a></li>
<li><a href="#storing-data">Storing Data</a></li>
<li><a href="#flash-data">Flash Data</a></li>
<li><a href="#deleting-data">Deleting Data</a></li>
<li><a href="#regenerating-the-session-id">Regenerating The Session ID</a></li>
</ul></li>
<li><a href="#adding-custom-session-drivers">Adding Custom Session Drivers</a>
<ul>
<li><a href="#implementing-the-driver">Implementing The Driver</a></li>
<li><a href="#registering-the-driver">Registering The Driver</a></li>
</ul></li>
</ul>
<p><a name="introduction"></a></p>
<h2 id="introduction">Introduction</h2>
<p>Since HTTP driven applications are stateless, sessions provide a way to store information about the user across multiple requests. Laravel ships with a variety of session backends that are accessed through an expressive, unified API. Support for popular backends such as <a href="https://memcached.org">Memcached</a>, <a href="http://redis.io">Redis</a>, and databases is included out of the box.</p>
<p><a name="configuration"></a></p>
<h3 id="configuration">Configuration</h3>
<p>The session configuration file is stored at <code>config/session.php</code>. Be sure to review the options available to you in this file. By default, Laravel is configured to use the <code>file</code> session driver, which will work well for many applications. In production applications, you may consider using the <code>memcached</code> or <code>redis</code> drivers for even faster session performance.</p>
<p>The session <code>driver</code> configuration option defines where session data will be stored for each request. Laravel ships with several great drivers out of the box:</p>
<div class="content-list" markdown="1">
- `file` - sessions are stored in `storage/framework/sessions`.
- `cookie` - sessions are stored in secure, encrypted cookies.
- `database` - sessions are stored in a relational database.
- `memcached` / `redis` - sessions are stored in one of these fast, cache based stores.
- `array` - sessions are stored in a PHP array and will not be persisted.
</div>
<blockquote>
<p>{tip} The array driver is used during <a href="/docs/%7B%7Bversion%7D%7D/testing">testing</a> and prevents the data stored in the session from being persisted.</p>
</blockquote>
<p><a name="driver-prerequisites"></a></p>
<h3 id="driver-prerequisites">Driver Prerequisites</h3>
<h4 id="database">Database</h4>
<p>When using the <code>database</code> session driver, you will need to create a table to contain the session items. Below is an example <code>Schema</code> declaration for the table:</p>
<pre><code>Schema::create(&#39;sessions&#39;, function ($table) {
    $table-&gt;string(&#39;id&#39;)-&gt;unique();
    $table-&gt;integer(&#39;user_id&#39;)-&gt;nullable();
    $table-&gt;string(&#39;ip_address&#39;, 45)-&gt;nullable();
    $table-&gt;text(&#39;user_agent&#39;)-&gt;nullable();
    $table-&gt;text(&#39;payload&#39;);
    $table-&gt;integer(&#39;last_activity&#39;);
});</code></pre>
<p>You may use the <code>session:table</code> Artisan command to generate this migration:</p>
<pre><code>php artisan session:table

php artisan migrate</code></pre>
<h4 id="redis">Redis</h4>
<p>Before using Redis sessions with Laravel, you will need to install the <code>predis/predis</code> package (~1.0) via Composer. You may configure your Redis connections in the <code>database</code> configuration file. In the <code>session</code> configuration file, the <code>connection</code> option may be used to specify which Redis connection is used by the session.</p>
<p><a name="using-the-session"></a></p>
<h2 id="using-the-session">Using The Session</h2>
<p><a name="retrieving-data"></a></p>
<h3 id="retrieving-data">Retrieving Data</h3>
<p>There are two primary ways of working with session data in Laravel: the global <code>session</code> helper and via a <code>Request</code> instance. First, let's look at accessing the session via a <code>Request</code> instance, which can be type-hinted on a controller method. Remember, controller method dependencies are automatically injected via the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>:</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Http\Controllers\Controller;

class UserController extends Controller
{
    /**
     * Show the profile for the given user.
     *
     * @param  Request  $request
     * @param  int  $id
     * @return Response
     */
    public function show(Request $request, $id)
    {
        $value = $request-&gt;session()-&gt;get(&#39;key&#39;);

        //
    }
}</code></pre>
<p>When you retrieve a value from the session, you may also pass a default value as the second argument to the <code>get</code> method. This default value will be returned if the specified key does not exist in the session. If you pass a <code>Closure</code> as the default value to the <code>get</code> method and the requested key does not exist, the <code>Closure</code> will be executed and its result returned:</p>
<pre><code>$value = $request-&gt;session()-&gt;get(&#39;key&#39;, &#39;default&#39;);

$value = $request-&gt;session()-&gt;get(&#39;key&#39;, function() {
    return &#39;default&#39;;
});</code></pre>
<h4 id="the-global-session-helper">The Global Session Helper</h4>
<p>You may also use the global <code>session</code> PHP function to retrieve and store data in the session. When the <code>session</code> helper is called with a single, string argument, it will return the value of that session key. When the helper is called with an array of key / value pairs, those values will be stored in the session:</p>
<pre><code>Route::get(&#39;home&#39;, function () {
    // Retrieve a piece of data from the session...
    $value = session(&#39;key&#39;);

    // Specifying a default value...
    $value = session(&#39;key&#39;, &#39;default&#39;);

    // Store a piece of data in the session...
    session([&#39;key&#39; =&gt; &#39;value&#39;]);
});</code></pre>
<blockquote>
<p>{tip} There is little practical difference between using the session via an HTTP request instance versus using the global <code>session</code> helper. Both methods are <a href="/docs/%7B%7Bversion%7D%7D/testing">testable</a> via the <code>assertSessionHas</code> method which is available in all of your test cases.</p>
</blockquote>
<h4 id="retrieving-all-session-data">Retrieving All Session Data</h4>
<p>If you would like to retrieve all the data in the session, you may use the <code>all</code> method:</p>
<pre><code>$data = $request-&gt;session()-&gt;all();</code></pre>
<h4 id="determining-if-an-item-exists-in-the-session">Determining If An Item Exists In The Session</h4>
<p>To determine if a value is present in the session, you may use the <code>has</code> method. The <code>has</code> method returns <code>true</code> if the value is present and is not <code>null</code>:</p>
<pre><code>if ($request-&gt;session()-&gt;has(&#39;users&#39;)) {
    //
}</code></pre>
<p>To determine if a value is present in the session, even if its value is <code>null</code>, you may use the <code>exists</code> method. The <code>exists</code> method returns <code>true</code> if the value is present:</p>
<pre><code>if ($request-&gt;session()-&gt;exists(&#39;users&#39;)) {
    //
}</code></pre>
<p><a name="storing-data"></a></p>
<h3 id="storing-data">Storing Data</h3>
<p>To store data in the session, you will typically use the <code>put</code> method or the <code>session</code> helper:</p>
<pre><code>// Via a request instance...
$request-&gt;session()-&gt;put(&#39;key&#39;, &#39;value&#39;);

// Via the global helper...
session([&#39;key&#39; =&gt; &#39;value&#39;]);</code></pre>
<h4 id="pushing-to-array-session-values">Pushing To Array Session Values</h4>
<p>The <code>push</code> method may be used to push a new value onto a session value that is an array. For example, if the <code>user.teams</code> key contains an array of team names, you may push a new value onto the array like so:</p>
<pre><code>$request-&gt;session()-&gt;push(&#39;user.teams&#39;, &#39;developers&#39;);</code></pre>
<h4 id="retrieving-deleting-an-item">Retrieving &amp; Deleting An Item</h4>
<p>The <code>pull</code> method will retrieve and delete an item from the session in a single statement:</p>
<pre><code>$value = $request-&gt;session()-&gt;pull(&#39;key&#39;, &#39;default&#39;);</code></pre>
<p><a name="flash-data"></a></p>
<h3 id="flash-data">Flash Data</h3>
<p>Sometimes you may wish to store items in the session only for the next request. You may do so using the <code>flash</code> method. Data stored in the session using this method will only be available during the subsequent HTTP request, and then will be deleted. Flash data is primarily useful for short-lived status messages:</p>
<pre><code>$request-&gt;session()-&gt;flash(&#39;status&#39;, &#39;Task was successful!&#39;);</code></pre>
<p>If you need to keep your flash data around for several requests, you may use the <code>reflash</code> method, which will keep all of the flash data for an additional request. If you only need to keep specific flash data, you may use the <code>keep</code> method:</p>
<pre><code>$request-&gt;session()-&gt;reflash();

$request-&gt;session()-&gt;keep([&#39;username&#39;, &#39;email&#39;]);</code></pre>
<p><a name="deleting-data"></a></p>
<h3 id="deleting-data">Deleting Data</h3>
<p>The <code>forget</code> method will remove a piece of data from the session. If you would like to remove all data from the session, you may use the <code>flush</code> method:</p>
<pre><code>$request-&gt;session()-&gt;forget(&#39;key&#39;);

$request-&gt;session()-&gt;flush();</code></pre>
<p><a name="regenerating-the-session-id"></a></p>
<h3 id="regenerating-the-session-id">Regenerating The Session ID</h3>
<p>Regenerating the session ID is often done in order to prevent malicious users from exploiting a <a href="https://en.wikipedia.org/wiki/Session_fixation">session fixation</a> attack on your application.</p>
<p>Laravel automatically regenerates the session ID during authentication if you are using the built-in <code>LoginController</code>; however, if you need to manually regenerate the session ID, you may use the <code>regenerate</code> method.</p>
<pre><code>$request-&gt;session()-&gt;regenerate();</code></pre>
<p><a name="adding-custom-session-drivers"></a></p>
<h2 id="adding-custom-session-drivers">Adding Custom Session Drivers</h2>
<p><a name="implementing-the-driver"></a></p>
<h4 id="implementing-the-driver">Implementing The Driver</h4>
<p>Your custom session driver should implement the <code>SessionHandlerInterface</code>. This interface contains just a few simple methods we need to implement. A stubbed MongoDB implementation looks something like this:</p>
<pre><code>&lt;?php

namespace App\Extensions;

class MongoHandler implements SessionHandlerInterface
{
    public function open($savePath, $sessionName) {}
    public function close() {}
    public function read($sessionId) {}
    public function write($sessionId, $data) {}
    public function destroy($sessionId) {}
    public function gc($lifetime) {}
}</code></pre>
<blockquote>
<p>{tip} Laravel does not ship with a directory to contain your extensions. You are free to place them anywhere you like. In this example, we have created an <code>Extensions</code> directory to house the <code>MongoHandler</code>.</p>
</blockquote>
<p>Since the purpose of these methods is not readily understandable, let's quickly cover what each of the methods do:</p>
<div class="content-list" markdown="1">
- The `open` method would typically be used in file based session store systems. Since Laravel ships with a `file` session driver, you will almost never need to put anything in this method. You can leave it as an empty stub. It is simply a fact of poor interface design (which we'll discuss later) that PHP requires us to implement this method.
- The `close` method, like the `open` method, can also usually be disregarded. For most drivers, it is not needed.
- The `read` method should return the string version of the session data associated with the given `$sessionId`. There is no need to do any serialization or other encoding when retrieving or storing session data in your driver, as Laravel will perform the serialization for you.
- The `write` method should write the given `$data` string associated with the `$sessionId` to some persistent storage system, such as MongoDB, Dynamo, etc.  Again, you should not perform any serialization - Laravel will have already handled that for you.
- The `destroy` method should remove the data associated with the `$sessionId` from persistent storage.
- The `gc` method should destroy all session data that is older than the given `$lifetime`, which is a UNIX timestamp. For self-expiring systems like Memcached and Redis, this method may be left empty.
</div>
<p><a name="registering-the-driver"></a></p>
<h4 id="registering-the-driver">Registering The Driver</h4>
<p>Once your driver has been implemented, you are ready to register it with the framework. To add additional drivers to Laravel's session backend, you may use the <code>extend</code> method on the <code>Session</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. You should call the <code>extend</code> method from the <code>boot</code> method of a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>. You may do this from the existing <code>AppServiceProvider</code> or create an entirely new provider:</p>
<pre><code>&lt;?php

namespace App\Providers;

use App\Extensions\MongoSessionStore;
use Illuminate\Support\Facades\Session;
use Illuminate\Support\ServiceProvider;

class SessionServiceProvider extends ServiceProvider
{
    /**
     * Perform post-registration booting of services.
     *
     * @return void
     */
    public function boot()
    {
        Session::extend(&#39;mongo&#39;, function($app) {
            // Return implementation of SessionHandlerInterface...
            return new MongoSessionStore;
        });
    }

    /**
     * Register bindings in the container.
     *
     * @return void
     */
    public function register()
    {
        //
    }
}</code></pre>
<p>Once the session driver has been registered, you may use the <code>mongo</code> driver in your <code>config/session.php</code> configuration file.</p>
</article>
</body>
</html>
