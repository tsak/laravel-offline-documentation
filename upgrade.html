<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Upgrade Guide â€“ </title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="github-pandoc.css">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../../laravel-docs/site.js"></script>
</head>
<body>
<aside><h1>Laravel 5.3 offline docs</h1><ul id="navigation">
<li><a href="application-testing.html">Application Testing</a>
<li><a href="artisan.html">Console Commands</a>
<li><a href="authentication.html">Authentication</a>
<li><a href="authorization.html">Authorization</a>
<li><a href="billing.html">Laravel Cashier</a>
<li><a href="blade.html">Blade Templates</a>
<li><a href="broadcasting.html">Event Broadcasting</a>
<li><a href="cache.html">Cache</a>
<li><a href="collections.html">Collections</a>
<li><a href="configuration.html">Configuration</a>
<li><a href="container.html">Service Container</a>
<li><a href="contracts.html">Contracts</a>
<li><a href="contributing.html">Contribution Guidelines</a>
<li><a href="contributions.html">Contribution Guide</a>
<li><a href="controllers.html">Controllers</a>
<li><a href="csrf.html">CSRF Protection</a>
<li><a href="database-testing.html">Database Testing</a>
<li><a href="database.html">Database: Getting Started</a>
<li><a href="documentation.html">Prologue</a>
<li><a href="elixir.html">Compiling Assets (Laravel Elixir)</a>
<li><a href="eloquent-collections.html">Eloquent: Collections</a>
<li><a href="eloquent-mutators.html">Eloquent: Mutators</a>
<li><a href="eloquent-relationships.html">Eloquent: Relationships</a>
<li><a href="eloquent-serialization.html">Eloquent: Serialization</a>
<li><a href="eloquent.html">Eloquent: Getting Started</a>
<li><a href="encryption.html">Encryption</a>
<li><a href="envoy.html">Envoy Task Runner</a>
<li><a href="errors.html">Errors & Logging</a>
<li><a href="events.html">Events
</a>
<li><a href="facades.html">Facades</a>
<li><a href="filesystem.html">Filesystem / Cloud Storage</a>
<li><a href="frontend.html">JavaScript & CSS</a>
<li><a href="hashing.html">Hashing</a>
<li><a href="helpers.html">Helper Functions</a>
<li><a href="homestead.html">Laravel Homestead</a>
<li><a href="installation.html">Installation</a>
<li><a href="lifecycle.html">Request Lifecycle</a>
<li><a href="localization.html">Localization</a>
<li><a href="mail.html">Mail
</a>
<li><a href="middleware.html">Middleware</a>
<li><a href="migrations.html">Database: Migrations</a>
<li><a href="mocking.html">Mocking</a>
<li><a href="notifications.html">Notifications</a>
<li><a href="packages.html">Package Development</a>
<li><a href="pagination.html">Pagination</a>
<li><a href="passport.html">API Authentication (Passport)</a>
<li><a href="passwords.html">Resetting Passwords</a>
<li><a href="providers.html">Service Providers</a>
<li><a href="queries.html">Database: Query Builder</a>
<li><a href="queues.html">Queues</a>
<li><a href="readme.html">Laravel Documentation</a>
<li><a href="redirects.html">HTTP Redirects</a>
<li><a href="redis.html">Redis</a>
<li><a href="releases.html">Release Notes</a>
<li><a href="requests.html">HTTP Requests</a>
<li><a href="responses.html">HTTP Responses</a>
<li><a href="routing.html">Routing</a>
<li><a href="scheduling.html">Task Scheduling</a>
<li><a href="scout.html">Laravel Scout</a>
<li><a href="seeding.html">Database: Seeding</a>
<li><a href="session.html">HTTP Session</a>
<li><a href="structure.html">Directory Structure</a>
<li><a href="testing.html">Testing</a>
<li><a href="upgrade.html">Upgrade Guide</a>
<li><a href="valet.html">Laravel Valet</a>
<li><a href="validation.html">Validation
</a>
<li><a href="views.html">Views</a>
</ul></aside><article>
<h1 id="upgrade-guide">Upgrade Guide</h1>
<ul>
<li><a href="#upgrade-5.3.0">Upgrading To 5.3.0 From 5.2</a></li>
<li><a href="#upgrade-5.2.0">Upgrading To 5.2.0 From 5.1</a></li>
<li><a href="#upgrade-5.1.11">Upgrading To 5.1.11</a></li>
<li><a href="#upgrade-5.1.0">Upgrading To 5.1.0</a></li>
<li><a href="#upgrade-5.0.16">Upgrading To 5.0.16</a></li>
<li><a href="#upgrade-5.0">Upgrading To 5.0 From 4.2</a></li>
<li><a href="#upgrade-4.2">Upgrading To 4.2 From 4.1</a></li>
<li><a href="#upgrade-4.1.29">Upgrading To 4.1.29 From &lt;= 4.1.x</a></li>
<li><a href="#upgrade-4.1.26">Upgrading To 4.1.26 From &lt;= 4.1.25</a></li>
<li><a href="#upgrade-4.1">Upgrading To 4.1 From 4.0</a></li>
</ul>
<p><a name="upgrade-5.3.0"></a></p>
<h2 id="upgrading-to-5.3.0-from-5.2">Upgrading To 5.3.0 From 5.2</h2>
<h4 id="estimated-upgrade-time-2-3-hours">Estimated Upgrade Time: 2-3 Hours</h4>
<blockquote>
<p>{note} We attempt to document every possible breaking change. Since some of these breaking changes are in obscure parts of the framework only a portion of these changes may actually affect your application.</p>
</blockquote>
<h3 id="updating-dependencies">Updating Dependencies</h3>
<p>Update your <code>laravel/framework</code> dependency to <code>5.3.*</code> in your <code>composer.json</code> file.</p>
<p>You should also upgrade your <code>symfony/css-selector</code> and <code>symfony/dom-crawler</code> dependencies to <code>3.1.*</code> in the <code>require-dev</code> section of your <code>composer.json</code> file.</p>
<h3 id="php-hhvm">PHP &amp; HHVM</h3>
<p>Laravel 5.3 requires PHP 5.6.4 or higher. HHVM is no longer officially supported as it does not contain the same language features as PHP 5.6+.</p>
<h3 id="deprecations">Deprecations</h3>
<p>All of the deprecations listed in the <a href="#5.2-deprecations">Laravel 5.2 upgrade guide</a> have been removed from the framework. You should review this list to verify you are no longer using these deprecated features.</p>
<h3 id="application-service-providers">Application Service Providers</h3>
<p>You may remove the arguments from the <code>boot</code> method on the <code>EventServiceProvider</code>, <code>RouteServiceProvider</code>, and <code>AuthServiceProvider</code> classes. Any calls to the given arguments may be converted to use the equivalent <a href="/docs/5.3/facades">facade</a> instead. So, for example, instead of calling methods on the <code>$dispatcher</code> argument, you may simply call the <code>Event</code> facade. Likewise, instead of making method calls to the <code>$router</code> argument, you may make calls to the <code>Route</code> facade, and instead of making method calls to the <code>$gate</code> argument, you may make calls to the <code>Gate</code> facade.</p>
<blockquote>
<p>{note} When converting method calls to facades, be sure to import the facade class into your service provider.</p>
</blockquote>
<h3 id="arrays">Arrays</h3>
<h4 id="key-value-order-change">Key / Value Order Change</h4>
<p>The <code>first</code>, <code>last</code>, and <code>where</code> methods on the <code>Arr</code> class now pass the &quot;value&quot; as the first parameter to the given callback Closure. For example:</p>
<pre><code>Arr::first($array, function ($value, $key) {
    return ! is_null($value);
});</code></pre>
<p>In previous versions of Laravel, the <code>$key</code> was passed first. Since most use cases are only interested in the <code>$value</code> it is now passed first. You should do a &quot;global find&quot; in your application for these methods to verify that you are expecting the <code>$value</code> to be passed as the first argument to your Closure.</p>
<h3 id="artisan">Artisan</h3>
<h5 id="the-makeconsole-command">The <code>make:console</code> Command</h5>
<p>The <code>make:console</code> command has been renamed to <code>make:command</code>.</p>
<h3 id="authentication">Authentication</h3>
<h4 id="authentication-scaffolding">Authentication Scaffolding</h4>
<p>The two default authentication controllers provided with the framework have been split into four smaller controllers. This change provides cleaner, more focused authentication controllers by default. The easiest way to upgrade your application to the new authentication controllers is to <a href="https://github.com/laravel/laravel/tree/master/app/Http/Controllers/Auth">grab a fresh copy of each controller from GitHub</a> and place them into your application.</p>
<p>You should also make sure that you are calling the <code>Auth::routes()</code> method in your <code>routes/web.php</code> file. This method will register the proper routes for the new authentication controllers.</p>
<p>Once these controllers have been placed into your application, you may need to re-implement any customizations you made to these controllers. For example, if you are customizing the authentication guard that is used for authentication, you may need to override the controller's <code>guard</code> method. You can examine each authentication controller's trait to determine which methods to override.</p>
<blockquote>
<p>{tip} If you were not customizing the authentication controllers, you should just be able to drop in fresh copies of the controllers from GitHub and verify that you are calling the <code>Auth::routes</code> method in your <code>routes/web.php</code> file.</p>
</blockquote>
<h4 id="password-reset-emails">Password Reset Emails</h4>
<p>Password reset emails now use the new Laravel notifications feature. If you would like to customize the notification sent when sending password reset links, you should override the <code>sendPasswordResetNotification</code> method of the <code>Illuminate\Auth\Passwords\CanResetPassword</code> trait.</p>
<p>Your <code>User</code> model <strong>must</strong> use the new <code>Illuminate\Notifications\Notifiable</code> trait in order for password reset link emails to be delivered:</p>
<pre><code>&lt;?php

namespace App;

use Illuminate\Notifications\Notifiable;
use Illuminate\Foundation\Auth\User as Authenticatable;

class User extends Authenticatable
{
    use Notifiable;
}</code></pre>
<blockquote>
<p>{note} Don't forget to register the <code>Illuminate\Notifications\NotificationServiceProvider</code> in the <code>providers</code> array of your <code>config/app.php</code> configuration file.</p>
</blockquote>
<h4 id="post-to-logout">POST To Logout</h4>
<p>The <code>Auth::routes</code> method now registers a <code>POST</code> route for <code>/logout</code> instead of a <code>GET</code> route. This prevents other web applications from logging your users out of your application. To upgrade, you should either convert your logout requests to use the <code>POST</code> verb or register your own <code>GET</code> route for the <code>/logout</code> URI:</p>
<pre><code>Route::get(&#39;/logout&#39;, &#39;Auth\LoginController@logout&#39;);</code></pre>
<h3 id="authorization">Authorization</h3>
<h4 id="calling-policy-methods-with-class-names">Calling Policy Methods With Class Names</h4>
<p>Some policy methods only receive the currently authenticated user and not an instance of the model they authorize. This situation is most common when authorizing <code>create</code> actions. For example, if you are creating a blog, you may wish to check if a user is authorized to create any posts at all.</p>
<p>When defining policy methods that will not receive a model instance, such as a <code>create</code> method, the class name will no longer be passed as the second argument to the method. Your method should just expect the authenticated user instance:</p>
<pre><code>/**
 * Determine if the given user can create posts.
 *
 * @param  \App\User  $user
 * @return bool
 */
public function create(User $user)
{
    //
}</code></pre>
<h4 id="the-authorizesresources-trait">The <code>AuthorizesResources</code> Trait</h4>
<p>The <code>AuthorizesResources</code> trait has been merged with the <code>AuthorizesRequests</code> trait. You should remove the <code>AuthorizesResources</code> trait from your <code>app/Http/Controllers/Controller.php</code> file.</p>
<h3 id="blade">Blade</h3>
<h4 id="custom-directives">Custom Directives</h4>
<p>In prior versions of Laravel, when registering custom Blade directives using the <code>directive</code> method, the <code>$expression</code> passed to your directive callback contained the outer-most parenthesis. In Laravel 5.3, these outer-most parenthesis are not included in the expression passed to your directive callback. Be sure to review the <a href="/docs/5.3/blade#extending-blade">Blade extension</a> documentation and verify your custom Blade directives are still working properly.</p>
<h3 id="broadcasting">Broadcasting</h3>
<h4 id="service-provider">Service Provider</h4>
<p>Laravel 5.3 includes significant improvements to <a href="/docs/%7B%7Bversion%7D%7D/broadcasting">event broadcasting</a>. You should add the new <code>BroadcastServiceProvider</code> to your <code>app/Providers</code> directory by <a href="https://raw.githubusercontent.com/laravel/laravel/develop/app/Providers/BroadcastServiceProvider.php">grabbing a fresh copy of the source from GitHub</a>. Once you have defined the new service provider, you should add it to the <code>providers</code> array of your <code>config/app.php</code> configuration file.</p>
<h3 id="cache">Cache</h3>
<h4 id="extension-closure-binding-this">Extension Closure Binding &amp; <code>$this</code></h4>
<p>When calling the <code>Cache::extend</code> method with a Closure, <code>$this</code> will be bound to the <code>CacheManager</code> instance, allowing you to call its methods from within your extension Closure:</p>
<pre><code>Cache::extend(&#39;memcached&#39;, function ($app, $config) {
    try {
        return $this-&gt;createMemcachedDriver($config);
    } catch (Exception $e) {
        return $this-&gt;createNullDriver($config);
    }
});</code></pre>
<h3 id="cashier">Cashier</h3>
<p>If you are using Cashier, you should upgrade your <code>laravel/cashier</code> package to the <code>~7.0</code> release. This release of Cashier only upgrades a few internal methods to be compatible with Laravel 5.3 and is not a breaking change.</p>
<h3 id="collections">Collections</h3>
<h4 id="key-value-order-change-1">Key / Value Order Change</h4>
<p>The <code>first</code>, <code>last</code>, and <code>contains</code> collection methods all pass the &quot;value&quot; as the first parameter to their given callback Closure. For example:</p>
<pre><code>$collection-&gt;first(function ($value, $key) {
    return ! is_null($value);
});</code></pre>
<p>In previous versions of Laravel, the <code>$key</code> was passed first. Since most use cases are only interested in the <code>$value</code> it is now passed first. You should do a &quot;global find&quot; in your application for these methods to verify that you are expecting the <code>$value</code> to be passed as the first argument to your Closure.</p>
<h4 id="collection-where-comparison-methods-are-loose-by-default">Collection <code>where</code> Comparison Methods Are &quot;Loose&quot; By Default</h4>
<p>A collection's <code>where</code> method now performs a &quot;loose&quot; comparison by default instead of a strict comparison. If you would like to perform a strict comparison, you may use the <code>whereStrict</code> method.</p>
<p>The <code>where</code> method also no longer accepts a third parameter to indicate &quot;strictness&quot;. You should explicitly call either <code>where</code> or <code>whereStrict</code> depending on your application's needs.</p>
<h3 id="controllers">Controllers</h3>
<p><a name="5.3-session-in-constructors"></a></p>
<h4 id="session-in-the-constructor">Session In The Constructor</h4>
<p>In previous versions of Laravel, you could access session variables or the authenticated user in your controller's constructor. This was never intended to be an explicit feature of the framework. In Laravel 5.3, you can't access the session or authenticated user in your controller's constructor because the middleware has not run yet.</p>
<p>As an alternative, you may define a Closure based middleware directly in your controller's constructor. Before using this feature, make sure that your application is running Laravel <code>5.3.4</code> or above:</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use App\User;
use Illuminate\Support\Facades\Auth;
use App\Http\Controllers\Controller;

class ProjectController extends Controller
{
    /**
     * All of the current user&#39;s projects.
     */
    protected $projects;

    /**
     * Create a new controller instance.
     *
     * @return void
     */
    public function __construct()
    {
        $this-&gt;middleware(function ($request, $next) {
            $this-&gt;projects = Auth::user()-&gt;projects;

            return $next($request);
        });
    }
}</code></pre>
<p>Of course, you may also access the request session data or authenticated user by type-hinting the <code>Illuminate\Http\Request</code> class on your controller action:</p>
<pre><code>/**
 * Show all of the projects for the current user.
 *
 * @param  \Illuminate\Http\Request  $request
 * @return Response
 */
public function index(Request $request)
{
    $projects = $request-&gt;user()-&gt;projects;

    $value = $request-&gt;session()-&gt;get(&#39;key&#39;);

    //
}</code></pre>
<h3 id="database">Database</h3>
<h4 id="collections-1">Collections</h4>
<p>The <a href="/docs/%7B%7Bversion%7D%7D/queries">fluent query builder</a> now returns <code>Illuminate\Support\Collection</code> instances instead of plain arrays. This brings consistency to the result types returned by the fluent query builder and Eloquent.</p>
<p>If you do not want to migrate your query builder results to <code>Collection</code> instances, you may chain the <code>all</code> method onto your calls to the query builder's <code>get</code> or <code>pluck</code> methods. This will return a plain PHP array of the results, allowing you to maintain backwards compatibility:</p>
<pre><code>$users = DB::table(&#39;users&#39;)-&gt;get()-&gt;all();

$usersIds = DB::table(&#39;users&#39;)-&gt;pluck(&#39;id&#39;)-&gt;all();</code></pre>
<h4 id="eloquent-morphclass-property">Eloquent <code>$morphClass</code> Property</h4>
<p>The <code>$morphClass</code> property that could be defined on Eloquent models has been removed in favor of defining a &quot;morph map&quot;. Defining a morph map provides support for eager loading and resolves additional bugs with polymorphic relations. If you were previously relying on the <code>$morphClass</code> property, you should migrate to <code>morphMap</code> using the following syntax:</p>
<div class="sourceCode"><pre class="sourceCode php"><code class="sourceCode php">Relation::morphMap<span class="ot">([</span>
    <span class="st">&#39;YourCustomMorphName&#39;</span> =&gt; YourModel::<span class="kw">class</span><span class="ot">,</span>
<span class="ot">]);</span></code></pre></div>
<p>For example, if you previously defined the following <code>$morphClass</code>:</p>
<div class="sourceCode"><pre class="sourceCode php"><code class="sourceCode php"><span class="kw">class</span> User <span class="kw">extends</span> Model
{
    <span class="kw">protected</span> <span class="kw">$morphClass</span> = <span class="st">&#39;user&#39;</span>
}</code></pre></div>
<p>You should define the following <code>morphMap</code> in the <code>boot</code> method of your <code>AppServiceProvider</code>:</p>
<div class="sourceCode"><pre class="sourceCode php"><code class="sourceCode php"><span class="kw">use</span> Illuminate\Database\Eloquent\Relations\Relation<span class="ot">;</span>

Relation::morphMap<span class="ot">([</span>
    <span class="st">&#39;user&#39;</span> =&gt; User::<span class="kw">class</span><span class="ot">,</span>
<span class="ot">]);</span></code></pre></div>
<h4 id="eloquent-save-method">Eloquent <code>save</code> Method</h4>
<p>The Eloquent <code>save</code> method now returns <code>false</code> if the model has not been changed since the last time it was retrieved or saved.</p>
<h4 id="eloquent-scopes">Eloquent Scopes</h4>
<p>Eloquent scopes now respect the leading boolean of scope constraints. For example, if you are starting your scope with an <code>orWhere</code> constraint it will no longer be converted to normal <code>where</code>. If you were relying on this feature (e.g. adding multiple <code>orWhere</code> constraints within a loop), you should verify that the first condition is a normal <code>where</code> to avoid any boolean logic issues.</p>
<p>If your scopes begin with <code>where</code> constraints no action is required. Remember, you can verify your query SQL using the <code>toSql</code> method of a query:</p>
<pre><code>User::where(&#39;foo&#39;, &#39;bar&#39;)-&gt;toSql();</code></pre>
<h4 id="join-clause">Join Clause</h4>
<p>The <code>JoinClause</code> class has been rewritten to unify its syntax with the query builder. The optional <code>$where</code> parameter of the <code>on</code> clause has been removed. To add a &quot;where&quot; conditions you should explicitly use one of the <code>where</code> methods offered by the <a href="/docs/%7B%7Bversion%7D%7D/queries#where-clauses">query builder</a>:</p>
<pre><code>$query-&gt;join(&#39;table&#39;, function ($join) {
    $join-&gt;on(&#39;foo&#39;, &#39;bar&#39;)-&gt;where(&#39;bar&#39;, &#39;baz&#39;);
});</code></pre>
<p>The operator of the <code>on</code> clause is now validated and can no longer contain invalid values. If you were relying on this feature (e.g. <code>$join-&gt;on('foo', 'in', DB::raw('(&quot;bar&quot;)'))</code>) you should rewrite the condition using the appropriate where clause:</p>
<pre><code>$join-&gt;whereIn(&#39;foo&#39;, [&#39;bar&#39;]);</code></pre>
<p>The <code>$bindings</code> property was also removed. To manipulate join bindings directly you may use the <code>addBinding</code> method:</p>
<pre><code>$query-&gt;join(DB::raw(&#39;(&#39;.$subquery-&gt;toSql().&#39;) table&#39;), function ($join) use ($subquery) {
    $join-&gt;addBinding($subquery-&gt;getBindings(), &#39;join&#39;);
});</code></pre>
<h3 id="encryption">Encryption</h3>
<h4 id="mcrypt-encrypter-has-been-removed">Mcrypt Encrypter Has Been Removed</h4>
<p>The Mcrypt encrypter was deprecated during the Laravel 5.1.0 release in June 2015. This encrypter has been totally removed in the 5.3.0 release in favor of the newer encryption implementation based on OpenSSL, which has been the default encryption scheme for all releases since Laravel 5.1.0.</p>
<p>If you are still using an Mcrypt based <code>cipher</code> in your <code>config/app.php</code> configuration file, you should update the cipher to <code>AES-256-CBC</code> and set your key to a random 32 byte string which may be securely generated using <code>php artisan key:generate</code>.</p>
<p>If you are storing encrypted data in your database using the Mcrypt encrypter, you may install the <code>laravel/legacy-encrypter</code> <a href="https://github.com/laravel/legacy-encrypter">package</a> which includes the legacy Mcrypt encrypter implementation. You should use this package to decrypt your encrypted data and re-encrypt it using the new OpenSSL encrypter. For example, you may do something like the following in a <a href="/docs/%7B%7Bversion%7D%7D/artisan">custom Artisan command</a>:</p>
<pre><code>$legacy = new McryptEncrypter($encryptionKey);

foreach ($records as $record) {
    $record-&gt;encrypted = encrypt(
        $legacy-&gt;decrypt($record-&gt;encrypted)
    );

    $record-&gt;save();
}</code></pre>
<h3 id="exception-handler">Exception Handler</h3>
<h4 id="constructor">Constructor</h4>
<p>The base exception handler class now requires a <code>Illuminate\Container\Container</code> instance to be passed to its constructor. This change will only affect your application if you have defined a custom <code>__construct</code> method in your <code>app/Exceptions/Handler.php</code> file. If you have done this, you should pass a container instance into the <code>parent::__construct</code> method:</p>
<pre><code>parent::__construct(app());</code></pre>
<h4 id="unauthenticated-method">Unauthenticated Method</h4>
<p>You should add the <code>unauthenticated</code> method to your <code>App\Exceptions\Handler</code> class. This method will convert authentication exceptions into HTTP responses:</p>
<pre><code>/**
 * Convert an authentication exception into an unauthenticated response.
 *
 * @param  \Illuminate\Http\Request  $request
 * @param  \Illuminate\Auth\AuthenticationException  $exception
 * @return \Illuminate\Http\Response
 */
protected function unauthenticated($request, AuthenticationException $exception)
{
    if ($request-&gt;expectsJson()) {
        return response()-&gt;json([&#39;error&#39; =&gt; &#39;Unauthenticated.&#39;], 401);
    }

    return redirect()-&gt;guest(&#39;login&#39;);
}</code></pre>
<h3 id="middleware">Middleware</h3>
<h4 id="can-middleware-namespace-change"><code>can</code> Middleware Namespace Change</h4>
<p>The <code>can</code> middleware listed in the <code>$routeMiddleware</code> property of your HTTP kernel should be updated to the following class:</p>
<pre><code>&#39;can&#39; =&gt; \Illuminate\Auth\Middleware\Authorize::class,</code></pre>
<h4 id="can-middleware-authentication-exception"><code>can</code> Middleware Authentication Exception</h4>
<p>The <code>can</code> middleware will now throw an instance of <code>Illuminate\Auth\AuthenticationException</code> if the user is not authenticated. If you were manually catching a different exception type, you should update your application to catch this exception. In most cases, this change will not affect your application.</p>
<h4 id="binding-substitution-middleware">Binding Substitution Middleware</h4>
<p>Route model binding is now accomplished using middleware. All applications should add the <code>Illuminate\Routing\Middleware\SubstituteBindings</code> to your <code>web</code> middleware group in your <code>app/Http/Kernel.php</code> file:</p>
<pre><code>\Illuminate\Routing\Middleware\SubstituteBindings::class,</code></pre>
<p>You should also register a route middleware for binding substitution in the <code>$routeMiddleware</code> property of your HTTP kernel:</p>
<pre><code>&#39;bindings&#39; =&gt; \Illuminate\Routing\Middleware\SubstituteBindings::class,</code></pre>
<p>Once this route middleware has been registered, you should add it to the <code>api</code> middleware group:</p>
<pre><code>&#39;api&#39; =&gt; [
    &#39;throttle:60,1&#39;,
    &#39;bindings&#39;,
],</code></pre>
<h3 id="notifications">Notifications</h3>
<h4 id="installation">Installation</h4>
<p>Laravel 5.3 includes a new, driver based notification system. You should register the <code>Illuminate\Notifications\NotificationServiceProvider</code> in the <code>providers</code> array of your <code>config/app.php</code> configuration file.</p>
<p>You should also add the <code>Illuminate\Support\Facades\Notification</code> facade to the <code>aliases</code> array of your <code>config/app.php</code> configuration file.</p>
<p>Finally, you may use the <code>Illuminate\Notifications\Notifiable</code> trait on your <code>User</code> model or any other model you wish to receive notifications.</p>
<h3 id="pagination">Pagination</h3>
<h4 id="customization">Customization</h4>
<p>Customizing the paginator's generated HTML is much easier in Laravel 5.3 compared to previous Laravel 5.x releases. Instead of defining a &quot;Presenter&quot; class, you only need to define a simple Blade template. The easiest way to customize the pagination views is by exporting them to your <code>resources/views/vendor</code> directory using the <code>vendor:publish</code> command:</p>
<pre><code>php artisan vendor:publish --tag=laravel-pagination</code></pre>
<p>This command will place the views in the <code>resources/views/vendor/pagination</code> directory. The <code>default.blade.php</code> file within this directory corresponds to the default pagination view. Simply edit this file to modify the pagination HTML.</p>
<p>Be sure to review the full <a href="/docs/%7B%7Bversion%7D%7D/pagination">pagination documentation</a> for more information.</p>
<h3 id="queue">Queue</h3>
<h4 id="configuration">Configuration</h4>
<p>In your queue configuration, all <code>expire</code> configuration items should be renamed to <code>retry_after</code>. Likewise, the Beanstalk configuration's <code>ttr</code> item should be renamed to <code>retry_after</code>. This name change provides more clarity on the purpose of this configuration option.</p>
<h4 id="closures">Closures</h4>
<p>Queueing Closures is no longer supported. If you are queueing a Closure in your application, you should convert the Closure to a class and queue an instance of the class:</p>
<pre><code>dispatch(new ProcessPodcast($podcast));</code></pre>
<h4 id="collection-serialization">Collection Serialization</h4>
<p>The <code>Illuminate\Queue\SerializesModels</code> trait now properly serializes instances of <code>Illuminate\Database\Eloquent\Collection</code>. This will most likely not be a breaking change for the vast majority of applications; however, if your application is absolutely dependent on collections not being re-retrieved from the database by queued jobs, you should verify that this change does not negatively affect your application.</p>
<h4 id="daemon-workers">Daemon Workers</h4>
<p>It is no longer necessary to specify the <code>--daemon</code> option when calling the <code>queue:work</code> Artisan command. Running the <code>php artisan queue:work</code> command will automatically assume that you want to run the worker in daemon mode. If you would like to process a single job, you may use the <code>--once</code> option on the command:</p>
<pre><code>// Start a daemon queue worker...
php artisan queue:work

// Process a single job...
php artisan queue:work --once</code></pre>
<h4 id="event-data-changes">Event Data Changes</h4>
<p>Various queue job events such as <code>JobProcessing</code> and <code>JobProcessed</code> no longer contain the <code>$data</code> property. You should update your application to call <code>$event-&gt;job-&gt;payload()</code> to get the equivalent data.</p>
<h4 id="database-driver-changes">Database Driver Changes</h4>
<p>If you are using the <code>database</code> driver to store your queued jobs, you should drop the <code>jobs_queue_reserved_reserved_at_index</code> index then drop the <code>reserved</code> column from your <code>jobs</code> table. This column is no longer required when using the <code>database</code> driver. Once you have completed these changes, you should add a new compound index on the <code>queue</code> and <code>reserved_at</code> columns.</p>
<p>Below is an example migration you may use to perform the necessary changes:</p>
<pre><code>public function up()
{
    Schema::table(&#39;jobs&#39;, function (Blueprint $table) {
        $table-&gt;dropIndex(&#39;jobs_queue_reserved_reserved_at_index&#39;);
        $table-&gt;dropColumn(&#39;reserved&#39;);
        $table-&gt;index([&#39;queue&#39;, &#39;reserved_at&#39;]);
    });

    Schema::table(&#39;failed_jobs&#39;, function (Blueprint $table) {
        $table-&gt;longText(&#39;exception&#39;)-&gt;after(&#39;payload&#39;);
    });
}

public function down()
{
    Schema::table(&#39;jobs&#39;, function (Blueprint $table) {
        $table-&gt;tinyInteger(&#39;reserved&#39;)-&gt;unsigned();
        $table-&gt;index([&#39;queue&#39;, &#39;reserved&#39;, &#39;reserved_at&#39;]);
        $table-&gt;dropIndex(&#39;jobs_queue_reserved_at_index&#39;);
    });

    Schema::table(&#39;failed_jobs&#39;, function (Blueprint $table) {
        $table-&gt;dropColumn(&#39;exception&#39;);
    });
}</code></pre>
<h4 id="process-control-extension">Process Control Extension</h4>
<p>If your application makes use of the <code>--timeout</code> option for queue workers, you'll need to verify that the <a href="https://secure.php.net/manual/en/pcntl.installation.php">pcntl extension</a> is installed.</p>
<h4 id="serializing-models-on-legacy-style-queue-jobs">Serializing Models On Legacy Style Queue Jobs</h4>
<p>Typically, jobs in Laravel are queued by passing a new job instance to the <code>Queue::push</code> method. However, some applications may be queuing jobs using the following legacy syntax:</p>
<pre><code>Queue::push(&#39;ClassName@method&#39;);</code></pre>
<p>If you are queueing jobs using this syntax, Eloquent models will no longer be automatically serialized and re-retrieved by the queue. If you would like your Eloquent models to be automatically serialized by the queue, you should use the <code>Illuminate\Queue\SerializesModels</code> trait on your job class and queue the job using the new <code>push</code> syntax:</p>
<pre><code>Queue::push(new ClassName);</code></pre>
<h3 id="routing">Routing</h3>
<h4 id="resource-parameters-are-singular-by-default">Resource Parameters Are Singular By Default</h4>
<p>In previous versions of Laravel, route parameters registered using <code>Route::resource</code> were not &quot;singularized&quot;. This could lead to some unexpected behavior when registering route model bindings. For example, given the following <code>Route::resource</code> call:</p>
<pre><code>Route::resource(&#39;photos&#39;, &#39;PhotoController&#39;);</code></pre>
<p>The URI for the <code>show</code> route would be defined as follows:</p>
<pre><code>/photos/{photos}</code></pre>
<p>In Laravel 5.3, all resource route parameters are singularized by default. So, the same call to <code>Route::resource</code> would register the following URI:</p>
<pre><code>/photos/{photo}</code></pre>
<p>If you would like to maintain the previous behavior instead of automatically singularizing resource route parameters, you may make the following call to the <code>singularResourceParameters</code> method in your <code>AppServiceProvider</code>:</p>
<pre><code>use Illuminate\Support\Facades\Route;

Route::singularResourceParameters(false);</code></pre>
<h4 id="resource-route-names-no-longer-affected-by-prefixes">Resource Route Names No Longer Affected By Prefixes</h4>
<p>URL prefixes no longer affect the route names assigned to routes when using <code>Route::resource</code>, since this behavior defeated the entire purpose of using route names in the first place.</p>
<p>If your application is using <code>Route::resource</code> within a <code>Route::group</code> call that specified a <code>prefix</code> option, you should examine all of your <code>route</code> helper and <code>UrlGenerator::route</code> calls to verify that you are no longer appending this URI prefix to the route name.</p>
<p>If this change causes you to have two routes with the same name, you have two options. First, you may use the <code>names</code> option when calling <code>Route::resource</code> to specify a custom name for a given route. Refer to the <a href="/docs/5.3/controllers#resource-controllers">resource routing documentation</a> for more information. Alternatively, you may add the <code>as</code> option on your route group:</p>
<pre><code>Route::group([&#39;as&#39; =&gt; &#39;admin.&#39;, &#39;prefix&#39; =&gt; &#39;admin&#39;], function () {
    //
});</code></pre>
<h3 id="validation">Validation</h3>
<h4 id="form-request-exceptions">Form Request Exceptions</h4>
<p>If a form request's validation fails, Laravel will now throw an instance of <code>Illuminate\Validation\ValidationException</code> instead of an instance of <code>HttpException</code>. If you are manually catching the <code>HttpException</code> instance thrown by a form request, you should update your <code>catch</code> blocks to catch the <code>ValidationException</code> instead.</p>
<h4 id="the-message-bag">The Message Bag</h4>
<p>If you were previously using the <code>has</code> method to determine if an <code>Illuminate\Support\MessageBag</code> instance contained any messages, you should use the <code>count</code> method instead. The <code>has</code> method now requires a parameter and only determines if a specific key exists in the message bag.</p>
<h4 id="nullable-primitives">Nullable Primitives</h4>
<p>When validating arrays, booleans, integers, numerics, and strings, <code>null</code> will no longer be considered a valid value unless the rule set contains the new <code>nullable</code> rule:</p>
<pre><code>Validate::make($request-&gt;all(), [
    &#39;field&#39; =&gt; &#39;nullable|max:5&#39;,
]);</code></pre>
<p><a name="upgrade-5.2.0"></a></p>
<h2 id="upgrading-to-5.2.0-from-5.1">Upgrading To 5.2.0 From 5.1</h2>
<h4 id="estimated-upgrade-time-less-than-1-hour">Estimated Upgrade Time: Less Than 1 Hour</h4>
<blockquote>
<p>{note} We attempt to provide a very comprehensive listing of every possible breaking change made to the framework. However, many of these changes may not apply to your own application.</p>
</blockquote>
<h3 id="updating-dependencies-1">Updating Dependencies</h3>
<p>Update your <code>composer.json</code> file to point to <code>laravel/framework 5.2.*</code>.</p>
<p>Add <code>&quot;symfony/dom-crawler&quot;: &quot;~3.0&quot;</code> and <code>&quot;symfony/css-selector&quot;: &quot;~3.0&quot;</code> to the <code>require-dev</code> section of your <code>composer.json</code> file.</p>
<h3 id="authentication-1">Authentication</h3>
<h4 id="configuration-file">Configuration File</h4>
<p>You should update your <code>config/auth.php</code> configuration file with the following: <a href="https://github.com/laravel/laravel/blob/5.2/config/auth.php" class="uri">https://github.com/laravel/laravel/blob/5.2/config/auth.php</a></p>
<p>Once you have updated the file with a fresh copy, set your authentication configuration options to their desired value based on your old configuration file. If you were using the typical, Eloquent based authentication services available in Laravel 5.1, most values should remain the same.</p>
<p>Take special note of the <code>passwords.users.email</code> configuration option in the new <code>auth.php</code> configuration file and verify that the view path matches the actual view path for your application, as the default path to this view was changed in Laravel 5.2. If the default value in the new configuration file does not match your existing view, update the configuration option.</p>
<h4 id="contracts">Contracts</h4>
<p>If you are implementing the <code>Illuminate\Contracts\Auth\Authenticatable</code> contract but are <strong>not</strong> using the <code>Authenticatable</code> trait, you should add a new <code>getAuthIdentifierName</code> method to your contract implementation. Typically, this method will return the column name of the &quot;primary key&quot; of your authenticatable entity. For example: <code>id</code>.</p>
<p>This is unlikely to affect your application unless you were manually implementing this interface.</p>
<h4 id="custom-drivers">Custom Drivers</h4>
<p>If you are using the <code>Auth::extend</code> method to define a custom method of retrieving users, you should now use <code>Auth::provider</code> to define your custom user provider. Once you have defined the custom provider, you may configure it in the <code>providers</code> array of your new <code>auth.php</code> configuration file.</p>
<p>For more information on custom authentication providers, consult the <a href="/docs/%7B%7Bversion%7D%7D/authentication">full authentication documentation</a>.</p>
<h4 id="redirection">Redirection</h4>
<p>The <code>loginPath()</code> method has been removed from <code>Illuminate\Foundation\Auth\AuthenticatesUsers</code>, so placing a <code>$loginPath</code> variable in your <code>AuthController</code> is no longer required. By default, the trait will always redirect users back to their previous location on authentication errors.</p>
<h3 id="authorization-1">Authorization</h3>
<p>The <code>Illuminate\Auth\Access\UnauthorizedException</code> has been renamed to <code>Illuminate\Auth\Access\AuthorizationException</code>. This is unlikely to affect your application if you are not manually catching this exception.</p>
<h3 id="collections-2">Collections</h3>
<h4 id="eloquent-base-collections">Eloquent Base Collections</h4>
<p>The Eloquent collection instance now returns a base Collection (<code>Illuminate\Support\Collection</code>) for the following methods: <code>pluck</code>, <code>keys</code>, <code>zip</code>, <code>collapse</code>, <code>flatten</code>, <code>flip</code>.</p>
<h4 id="key-preservation">Key Preservation</h4>
<p>The <code>slice</code>, <code>chunk</code>, and <code>reverse</code> methods now preserve keys on the collection. If you do not want these methods to preserve keys, use the <code>values</code> method on the <code>Collection</code> instance.</p>
<h3 id="composer-class">Composer Class</h3>
<p>The <code>Illuminate\Foundation\Composer</code> class has been moved to <code>Illuminate\Support\Composer</code>. This is unlikely to affect your application if you were not manually using this class.</p>
<h3 id="commands-and-handlers">Commands And Handlers</h3>
<h4 id="self-handling-commands">Self-Handling Commands</h4>
<p>You no longer need to implement the <code>SelfHandling</code> contract on your jobs / commands. All jobs are now self-handling by default, so you can remove this interface from your classes.</p>
<h4 id="separate-commands-handlers">Separate Commands &amp; Handlers</h4>
<p>The Laravel 5.2 command bus now only supports self-handling commands and no longer supports separate commands and handlers.</p>
<p>If you would like to continue using separate commands and handlers, you may install a Laravel Collective package which provides backwards-compatible support for this: <a href="https://github.com/laravelcollective/bus">https://github.com/LaravelCollective/bus</a></p>
<h3 id="configuration-1">Configuration</h3>
<h4 id="environment-value">Environment Value</h4>
<p>Add an <code>env</code> configuration option to your <code>app.php</code> configuration file that looks like the following:</p>
<pre><code>&#39;env&#39; =&gt; env(&#39;APP_ENV&#39;, &#39;production&#39;),</code></pre>
<h4 id="caching-and-env">Caching And Env</h4>
<p>If you are using the <code>config:cache</code> command during deployment, you <strong>must</strong> make sure that you are only calling the <code>env</code> function from within your configuration files, and not from anywhere else in your application.</p>
<p>If you are calling <code>env</code> from within your application, it is strongly recommended you add proper configuration values to your configuration files and call <code>env</code> from that location instead, allowing you to convert your <code>env</code> calls to <code>config</code> calls.</p>
<h4 id="compiled-classes">Compiled Classes</h4>
<p>If present, remove the following lines from <code>config/compile.php</code> in the <code>files</code> array:</p>
<pre><code>realpath(__DIR__.&#39;/../app/Providers/BusServiceProvider.php&#39;),
realpath(__DIR__.&#39;/../app/Providers/ConfigServiceProvider.php&#39;),</code></pre>
<p>Not doing so can trigger an error when running <code>php artisan optimize</code> if the service providers listed here do not exist.</p>
<h3 id="csrf-verification">CSRF Verification</h3>
<p>CSRF verification is no longer automatically performed when running unit tests. This is unlikely to affect your application.</p>
<h3 id="database-1">Database</h3>
<h4 id="mysql-dates">MySQL Dates</h4>
<p>Starting with MySQL 5.7, <code>0000-00-00 00:00:00</code> is no longer considered a valid date, since <code>strict</code> mode is enabled by default. All timestamp columns should receive a valid default value when you insert records into your database. You may use the <code>useCurrent</code> method in your migrations to default the timestamp columns to the current timestamps, or you may make the timestamps <code>nullable</code> to allow <code>null</code> values:</p>
<pre><code>$table-&gt;timestamp(&#39;foo&#39;)-&gt;nullable();

$table-&gt;timestamp(&#39;foo&#39;)-&gt;useCurrent();

$table-&gt;nullableTimestamps();</code></pre>
<h4 id="mysql-json-column-type">MySQL JSON Column Type</h4>
<p>The <code>json</code> column type now creates actual JSON columns when used by the MySQL driver. If you are not running MySQL 5.7 or above, this column type will not be available to you. Instead, use the <code>text</code> column type in your migration.</p>
<h4 id="seeding">Seeding</h4>
<p>When running database seeds, all Eloquent models are now unguarded by default. Previously a call to <code>Model::unguard()</code> was required. You can call <code>Model::reguard()</code> at the top of your <code>DatabaseSeeder</code> class if you would like models to be guarded during seeding.</p>
<h3 id="eloquent">Eloquent</h3>
<h4 id="date-casts">Date Casts</h4>
<p>Any attributes that have been added to your <code>$casts</code> property as <code>date</code> or <code>datetime</code> will now be converted to a string when <code>toArray</code> is called on the model or collection of models. This makes the date casting conversion consistent with dates specified in your <code>$dates</code> array.</p>
<h4 id="global-scopes">Global Scopes</h4>
<p>The global scopes implementation has been re-written to be much easier to use. Your global scopes no longer need a <code>remove</code> method, so it may be removed from any global scopes you have written.</p>
<p>If you were calling <code>getQuery</code> on an Eloquent query builder to access the underlying query builder instance, you should now call <code>toBase</code>.</p>
<p>If you were calling the <code>remove</code> method directly for any reason, you should change this call to <code>$eloquentBuilder-&gt;withoutGlobalScope($scope)</code>.</p>
<p>New methods <code>withoutGlobalScope</code> and <code>withoutGlobalScopes</code> have been added to the Eloquent query builder. Any calls to <code>$model-&gt;removeGlobalScopes($builder)</code> may be changed to simply <code>$builder-&gt;withoutGlobalScopes()</code>.</p>
<h4 id="primary-keys">Primary keys</h4>
<p>By default, Eloquent assumes your primary keys are integers and will automatically cast them to integers. For any primary key that is not an integer you should override the <code>$incrementing</code> property on your Eloquent model to <code>false</code>:</p>
<pre><code>/**
 * Indicates if the IDs are auto-incrementing.
 *
 * @var bool
 */
public $incrementing = true;</code></pre>
<h3 id="events">Events</h3>
<h4 id="core-event-objects">Core Event Objects</h4>
<p>Some of the core events fired by Laravel now use event objects instead of string event names and dynamic parameters. Below is a list of the old event names and their new object based counterparts:</p>
<table style="width:39%;">
<colgroup>
<col style="width: 19%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="header">
<th>Old</th>
<th>New</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>artisan.start</code></td>
<td><code>Illuminate\Console\Events\ArtisanStarting</code></td>
</tr>
<tr class="even">
<td><code>auth.attempting</code></td>
<td><code>Illuminate\Auth\Events\Attempting</code></td>
</tr>
<tr class="odd">
<td><code>auth.login</code></td>
<td><code>Illuminate\Auth\Events\Login</code></td>
</tr>
<tr class="even">
<td><code>auth.logout</code></td>
<td><code>Illuminate\Auth\Events\Logout</code></td>
</tr>
<tr class="odd">
<td><code>cache.missed</code></td>
<td><code>Illuminate\Cache\Events\CacheMissed</code></td>
</tr>
<tr class="even">
<td><code>cache.hit</code></td>
<td><code>Illuminate\Cache\Events\CacheHit</code></td>
</tr>
<tr class="odd">
<td><code>cache.write</code></td>
<td><code>Illuminate\Cache\Events\KeyWritten</code></td>
</tr>
<tr class="even">
<td><code>cache.delete</code></td>
<td><code>Illuminate\Cache\Events\KeyForgotten</code></td>
</tr>
<tr class="odd">
<td><code>connection.{name}.beginTransaction</code></td>
<td><code>Illuminate\Database\Events\TransactionBeginning</code></td>
</tr>
<tr class="even">
<td><code>connection.{name}.committed</code></td>
<td><code>Illuminate\Database\Events\TransactionCommitted</code></td>
</tr>
<tr class="odd">
<td><code>connection.{name}.rollingBack</code></td>
<td><code>Illuminate\Database\Events\TransactionRolledBack</code></td>
</tr>
<tr class="even">
<td><code>illuminate.query</code></td>
<td><code>Illuminate\Database\Events\QueryExecuted</code></td>
</tr>
<tr class="odd">
<td><code>illuminate.queue.before</code></td>
<td><code>Illuminate\Queue\Events\JobProcessing</code></td>
</tr>
<tr class="even">
<td><code>illuminate.queue.after</code></td>
<td><code>Illuminate\Queue\Events\JobProcessed</code></td>
</tr>
<tr class="odd">
<td><code>illuminate.queue.failed</code></td>
<td><code>Illuminate\Queue\Events\JobFailed</code></td>
</tr>
<tr class="even">
<td><code>illuminate.queue.stopping</code></td>
<td><code>Illuminate\Queue\Events\WorkerStopping</code></td>
</tr>
<tr class="odd">
<td><code>mailer.sending</code></td>
<td><code>Illuminate\Mail\Events\MessageSending</code></td>
</tr>
<tr class="even">
<td><code>router.matched</code></td>
<td><code>Illuminate\Routing\Events\RouteMatched</code></td>
</tr>
</tbody>
</table>
<p>Each of these event objects contains <strong>exactly</strong> the same parameters that were passed to the event handler in Laravel 5.1. For example, if you were using <code>DB::listen</code> in 5.1.<em>, you may update your code like so for 5.2.</em>:</p>
<pre><code>DB::listen(function ($event) {
    dump($event-&gt;sql);
    dump($event-&gt;bindings);
});</code></pre>
<p>You may check out each of the new event object classes to see their public properties.</p>
<h3 id="exception-handling">Exception Handling</h3>
<p>Your <code>App\Exceptions\Handler</code> class' <code>$dontReport</code> property should be updated to include at least the following exception types:</p>
<pre><code>use Illuminate\Validation\ValidationException;
use Illuminate\Auth\Access\AuthorizationException;
use Illuminate\Database\Eloquent\ModelNotFoundException;
use Symfony\Component\HttpKernel\Exception\HttpException;

/**
 * A list of the exception types that should not be reported.
 *
 * @var array
 */
protected $dontReport = [
    AuthorizationException::class,
    HttpException::class,
    ModelNotFoundException::class,
    ValidationException::class,
];</code></pre>
<h3 id="helper-functions">Helper Functions</h3>
<p>The <code>url()</code> helper function now returns a <code>Illuminate\Routing\UrlGenerator</code> instance when no path is provided.</p>
<h3 id="implicit-model-binding">Implicit Model Binding</h3>
<p>Laravel 5.2 includes &quot;implicit model binding&quot;, a convenient new feature to automatically inject model instances into routes and controllers based on the identifier present in the URI. However, this does change the behavior of routes and controllers that type-hint model instances.</p>
<p>If you were type-hinting a model instance in your route or controller and were expecting an <strong>empty</strong> model instance to be injected, you should remove this type-hint and create an empty model instance directly within your route or controller; otherwise, Laravel will attempt to retrieve an existing model instance from the database based on the identifier present in the route's URI.</p>
<h3 id="ironmq">IronMQ</h3>
<p>The IronMQ queue driver has been moved into its own package and is no longer shipped with the core framework.</p>
<p><a href="https://github.com/laravelcollective/iron-queue">https://github.com/LaravelCollective/iron-queue</a></p>
<h3 id="jobs-queue">Jobs / Queue</h3>
<p>The <code>php artisan make:job</code> command now creates a &quot;queued&quot; job class definition by default. If you would like to create a &quot;sync&quot; job, use the <code>--sync</code> option when issuing the command.</p>
<h3 id="mail">Mail</h3>
<p>The <code>pretend</code> mail configuration option has been removed. Instead, use the <code>log</code> mail driver, which performs the same function as <code>pretend</code> and logs even more information about the mail message.</p>
<h3 id="pagination-1">Pagination</h3>
<p>To be consistent with other URLs generated by the framework, the paginator URLs no longer contain a trailing slash. This is unlikely to affect your application.</p>
<h3 id="service-providers">Service Providers</h3>
<p>The <code>Illuminate\Foundation\Providers\ArtisanServiceProvider</code> should be removed from your service provider list in your <code>app.php</code> configuration file.</p>
<p>The <code>Illuminate\Routing\ControllerServiceProvider</code> should be removed from your service provider list in your <code>app.php</code> configuration file.</p>
<h3 id="sessions">Sessions</h3>
<p>Because of changes to the authentication system, any existing sessions will be invalidated when you upgrade to Laravel 5.2.</p>
<h4 id="database-session-driver">Database Session Driver</h4>
<p>A new <code>database</code> session driver has been written for the framework which includes more information about the user such as their user ID, IP address, and user-agent. If you would like to continue using the old driver you may specify the <code>legacy-database</code> driver in your <code>session.php</code> configuration file.</p>
<p>If you would like to use the new driver, you should add the <code>user_id (nullable integer)</code>, <code>ip_address (nullable string)</code>, and <code>user_agent (text)</code> columns to your session database table.</p>
<h3 id="stringy">Stringy</h3>
<p>The &quot;Stringy&quot; library is no longer included with the framework. You may install it manually via Composer if you wish to use it in your application.</p>
<h3 id="validation-1">Validation</h3>
<h4 id="exception-types">Exception Types</h4>
<p>The <code>ValidatesRequests</code> trait now throws an instance of <code>Illuminate\Foundation\Validation\ValidationException</code> instead of throwing an instance of <code>Illuminate\Http\Exception\HttpResponseException</code>. This is unlikely to affect your application unless you were manually catching this exception.</p>
<p><a name="5.2-deprecations"></a></p>
<h3 id="deprecations-1">Deprecations</h3>
<p>The following features are deprecated in 5.2 and will be removed in the 5.3 release in June 2016:</p>
<ul>
<li><code>Illuminate\Contracts\Bus\SelfHandling</code> contract. Can be removed from jobs.</li>
<li>The <code>lists</code> method on the Collection, query builder and Eloquent query builder objects has been renamed to <code>pluck</code>. The method signature remains the same.</li>
<li>Implicit controller routes using <code>Route::controller</code> have been deprecated. Please use explicit route registration in your routes file. This will likely be extracted into a package.</li>
<li>The <code>get</code>, <code>post</code>, and other route helper functions have been removed. You may use the <code>Route</code> facade instead.</li>
<li>The <code>database</code> session driver from 5.1 has been renamed to <code>legacy-database</code> and will be removed. Consult notes on the &quot;database session driver&quot; above for more information.</li>
<li>The <code>Str::randomBytes</code> function has been deprecated in favor of the <code>random_bytes</code> native PHP function.</li>
<li>The <code>Str::equals</code> function has been deprecated in favor of the <code>hash_equals</code> native PHP function.</li>
<li><code>Illuminate\View\Expression</code> has been deprecated in favor of <code>Illuminate\Support\HtmlString</code>.</li>
<li>The <code>WincacheStore</code> cache driver has been removed.</li>
</ul>
<p><a name="upgrade-5.1.11"></a></p>
<h2 id="upgrading-to-5.1.11">Upgrading To 5.1.11</h2>
<p>Laravel 5.1.11 includes support for <a href="/docs/%7B%7Bversion%7D%7D/authorization">authorization</a> and <a href="/docs/%7B%7Bversion%7D%7D/authorization#policies">policies</a>. Incorporating these new features into your existing Laravel 5.1 applications is simple.</p>
<blockquote>
<p>{note} These upgrades are <strong>optional</strong>, and ignoring them will not affect your application.</p>
</blockquote>
<h4 id="create-the-policies-directory">Create The Policies Directory</h4>
<p>First, create an empty <code>app/Policies</code> directory within your application.</p>
<h4 id="create-register-the-authserviceprovider-gate-facade">Create / Register The AuthServiceProvider &amp; Gate Facade</h4>
<p>Create a <code>AuthServiceProvider</code> within your <code>app/Providers</code> directory. You may copy the contents of the default provider <a href="https://raw.githubusercontent.com/laravel/laravel/5.1/app/Providers/AuthServiceProvider.php">from GitHub</a>. Remember to change the provider's namespace if your application is using a custom namespace. After creating the provider, be sure to register it in your <code>app.php</code> configuration file's <code>providers</code> array.</p>
<p>Also, you should register the <code>Gate</code> facade in your <code>app.php</code> configuration file's <code>aliases</code> array:</p>
<pre><code>&#39;Gate&#39; =&gt; Illuminate\Support\Facades\Gate::class,</code></pre>
<h4 id="update-the-user-model">Update The User Model</h4>
<p>Secondly, use the <code>Illuminate\Foundation\Auth\Access\Authorizable</code> trait and <code>Illuminate\Contracts\Auth\Access\Authorizable</code> contract on your <code>App\User</code> model:</p>
<pre><code>&lt;?php

namespace App;

use Illuminate\Auth\Authenticatable;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Auth\Passwords\CanResetPassword;
use Illuminate\Foundation\Auth\Access\Authorizable;
use Illuminate\Contracts\Auth\Authenticatable as AuthenticatableContract;
use Illuminate\Contracts\Auth\Access\Authorizable as AuthorizableContract;
use Illuminate\Contracts\Auth\CanResetPassword as CanResetPasswordContract;

class User extends Model implements AuthenticatableContract,
                                    AuthorizableContract,
                                    CanResetPasswordContract
{
    use Authenticatable, Authorizable, CanResetPassword;
}</code></pre>
<h4 id="update-the-base-controller">Update The Base Controller</h4>
<p>Next, update your base <code>App\Http\Controllers\Controller</code> controller to use the <code>Illuminate\Foundation\Auth\Access\AuthorizesRequests</code> trait:</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use Illuminate\Foundation\Bus\DispatchesJobs;
use Illuminate\Routing\Controller as BaseController;
use Illuminate\Foundation\Validation\ValidatesRequests;
use Illuminate\Foundation\Auth\Access\AuthorizesRequests;

abstract class Controller extends BaseController
{
    use AuthorizesRequests, DispatchesJobs, ValidatesRequests;
}</code></pre>
<p><a name="upgrade-5.1.0"></a></p>
<h2 id="upgrading-to-5.1.0">Upgrading To 5.1.0</h2>
<h4 id="estimated-upgrade-time-less-than-1-hour-1">Estimated Upgrade Time: Less Than 1 Hour</h4>
<h3 id="update-bootstrapautoload.php">Update <code>bootstrap/autoload.php</code></h3>
<p>Update the <code>$compiledPath</code> variable in <code>bootstrap/autoload.php</code> to the following:</p>
<pre><code>$compiledPath = __DIR__.&#39;/cache/compiled.php&#39;;</code></pre>
<h3 id="create-bootstrapcache-directory">Create <code>bootstrap/cache</code> Directory</h3>
<p>Within your <code>bootstrap</code> directory, create a <code>cache</code> directory (<code>bootstrap/cache</code>). Place a <code>.gitignore</code> file in this directory with the following contents:</p>
<pre><code>*
!.gitignore</code></pre>
<p>This directory should be writable, and will be used by the framework to store temporary optimization files like <code>compiled.php</code>, <code>routes.php</code>, <code>config.php</code>, and <code>services.json</code>.</p>
<h3 id="add-broadcastserviceprovider-provider">Add <code>BroadcastServiceProvider</code> Provider</h3>
<p>Within your <code>config/app.php</code> configuration file, add <code>Illuminate\Broadcasting\BroadcastServiceProvider</code> to the <code>providers</code> array.</p>
<h3 id="authentication-2">Authentication</h3>
<p>If you are using the provided <code>AuthController</code> which uses the <code>AuthenticatesAndRegistersUsers</code> trait, you will need to make a few changes to how new users are validated and created.</p>
<p>First, you no longer need to pass the <code>Guard</code> and <code>Registrar</code> instances to the base constructor. You can remove these dependencies entirely from your controller's constructor.</p>
<p>Secondly, the <code>App\Services\Registrar</code> class used in Laravel 5.0 is no longer needed. You can simply copy and paste your <code>validator</code> and <code>create</code> method from this class directly into your <code>AuthController</code>. No other changes should need to be made to these methods; however, you should be sure to import the <code>Validator</code> facade and your <code>User</code> model at the top of your <code>AuthController</code>.</p>
<h4 id="password-controller">Password Controller</h4>
<p>The included <code>PasswordController</code> no longer requires any dependencies in its constructor. You may remove both of the dependencies that were required under 5.0.</p>
<h3 id="validation-2">Validation</h3>
<p>If you are overriding the <code>formatValidationErrors</code> method on your base controller class, you should now type-hint the <code>Illuminate\Contracts\Validation\Validator</code> contract instead of the concrete <code>Illuminate\Validation\Validator</code> instance.</p>
<p>Likewise, if you are overriding the <code>formatErrors</code> method on the base form request class, you should now type-hint <code>Illuminate\Contracts\Validation\Validator</code> contract instead of the concrete <code>Illuminate\Validation\Validator</code> instance.</p>
<h3 id="migrations">Migrations</h3>
<p>If you have any migrations that rename a column or any migrations that drop columns from a SQLite database, you will need to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file and run the <code>composer update</code> command in your terminal to install the library.</p>
<h3 id="eloquent-1">Eloquent</h3>
<h4 id="the-create-method">The <code>create</code> Method</h4>
<p>Eloquent's <code>create</code> method can now be called without any parameters. If you are overriding the <code>create</code> method in your own models, set the default value of the <code>$attributes</code> parameter to an array:</p>
<pre><code>public static function create(array $attributes = [])
{
    // Your custom implementation
}</code></pre>
<h4 id="the-find-method">The <code>find</code> Method</h4>
<p>If you are overriding the <code>find</code> method in your own models and calling <code>parent::find()</code> within your custom method, you should now change it to call the <code>find</code> method on the Eloquent query builder:</p>
<pre><code>public static function find($id, $columns = [&#39;*&#39;])
{
    $model = static::query()-&gt;find($id, $columns);

    // ...

    return $model;
}</code></pre>
<h4 id="the-lists-method">The <code>lists</code> Method</h4>
<p>The <code>lists</code> method now returns a <code>Collection</code> instance instead of a plain array for Eloquent queries. If you would like to convert the <code>Collection</code> into a plain array, use the <code>all</code> method:</p>
<pre><code>User::lists(&#39;id&#39;)-&gt;all();</code></pre>
<p>Be aware that the Query Builder <code>lists</code> method still returns an array.</p>
<h4 id="date-formatting">Date Formatting</h4>
<p>Previously, the storage format for Eloquent date fields could be modified by overriding the <code>getDateFormat</code> method on your model. This is still possible; however, for convenience you may simply specify a <code>$dateFormat</code> property on the model instead of overriding the method.</p>
<p>The date format is also now applied when serializing a model to an <code>array</code> or JSON. This may change the format of your JSON serialized date fields when migrating from Laravel 5.0 to 5.1. To set a specific date format for serialized models, you may override the <code>serializeDate(DateTime $date)</code> method on your model. This method allows you to have granular control over the formatting of serialized Eloquent date fields without changing their storage format.</p>
<h3 id="the-collection-class">The Collection Class</h3>
<h4 id="the-sort-method">The <code>sort</code> Method</h4>
<p>The <code>sort</code> method now returns a fresh collection instance instead of modifying the existing collection:</p>
<pre><code>$collection = $collection-&gt;sort($callback);</code></pre>
<h4 id="the-sortby-method">The <code>sortBy</code> Method</h4>
<p>The <code>sortBy</code> method now returns a fresh collection instance instead of modifying the existing collection:</p>
<pre><code>$collection = $collection-&gt;sortBy(&#39;name&#39;);</code></pre>
<h4 id="the-groupby-method">The <code>groupBy</code> Method</h4>
<p>The <code>groupBy</code> method now returns <code>Collection</code> instances for each item in the parent <code>Collection</code>. If you would like to convert all of the items back to plain arrays, you may <code>map</code> over them:</p>
<pre><code>$collection-&gt;groupBy(&#39;type&#39;)-&gt;map(function($item)
{
    return $item-&gt;all();
});</code></pre>
<h4 id="the-lists-method-1">The <code>lists</code> Method</h4>
<p>The <code>lists</code> method now returns a <code>Collection</code> instance instead of a plain array. If you would like to convert the <code>Collection</code> into a plain array, use the <code>all</code> method:</p>
<pre><code>$collection-&gt;lists(&#39;id&#39;)-&gt;all();</code></pre>
<h3 id="commands-handlers">Commands &amp; Handlers</h3>
<p>The <code>app/Commands</code> directory has been renamed to <code>app/Jobs</code>. However, you are not required to move all of your commands to the new location, and you may continue using the <code>make:command</code> and <code>handler:command</code> Artisan commands to generate your classes.</p>
<p>Likewise, the <code>app/Handlers</code> directory has been renamed to <code>app/Listeners</code> and now only contains event listeners. However, you are not required to move or rename your existing command and event handlers, and you may continue to use the <code>handler:event</code> command to generate event handlers.</p>
<p>By providing backwards compatibility for the Laravel 5.0 folder structure, you may upgrade your applications to Laravel 5.1 and slowly upgrade your events and commands to their new locations when it is convenient for you or your team.</p>
<h3 id="blade-1">Blade</h3>
<p>The <code>createMatcher</code>, <code>createOpenMatcher</code>, and <code>createPlainMatcher</code> methods have been removed from the Blade compiler. Use the new <code>directive</code> method to create custom directives for Blade in Laravel 5.1. Consult the <a href="/docs/%7B%7Bversion%7D%7D/blade#extending-blade">extending blade</a> documentation for more information.</p>
<h3 id="tests">Tests</h3>
<p>Add the protected <code>$baseUrl</code> property to the <code>tests/TestCase.php</code> file:</p>
<pre><code>protected $baseUrl = &#39;http://localhost&#39;;</code></pre>
<h3 id="translation-files">Translation Files</h3>
<p>The default directory for published language files for vendor packages has been moved. Move any vendor package language files from <code>resources/lang/packages/{locale}/{namespace}</code> to <code>resources/lang/vendor/{namespace}/{locale}</code> directory. For example, <code>Acme/Anvil</code> package's <code>acme/anvil::foo</code> namespaced English language file would be moved from <code>resources/lang/packages/en/acme/anvil/foo.php</code> to <code>resources/lang/vendor/acme/anvil/en/foo.php</code>.</p>
<h3 id="amazon-web-services-sdk">Amazon Web Services SDK</h3>
<p>If you are using the AWS SQS queue driver or the AWS SES e-mail driver, you should update your installed AWS PHP SDK to version 3.0.</p>
<p>If you are using the Amazon S3 filesystem driver, you will need to update the corresponding Flysystem package via Composer:</p>
<ul>
<li>Amazon S3: <code>league/flysystem-aws-s3-v3 ~1.0</code></li>
</ul>
<h3 id="deprecations-2">Deprecations</h3>
<p>The following Laravel features have been deprecated and will be removed entirely with the release of Laravel 5.2 in December 2015:</p>
<div class="content-list" markdown="1">
- Route filters have been deprecated in preference of [middleware](/docs/{{version}}/middleware).
- The `Illuminate\Contracts\Routing\Middleware` contract has been deprecated. No contract is required on your middleware. In addition, the `TerminableMiddleware` contract has also been deprecated. Instead of implementing the interface, simply define a `terminate` method on your middleware.
- The `Illuminate\Contracts\Queue\ShouldBeQueued` contract has been deprecated in favor of `Illuminate\Contracts\Queue\ShouldQueue`.
- Iron.io "push queues" have been deprecated in favor of typical Iron.io queues and [queue listeners](/docs/{{version}}/queues#running-the-queue-listener).
- The `Illuminate\Foundation\Bus\DispatchesCommands` trait has been deprecated and renamed to `Illuminate\Foundation\Bus\DispatchesJobs`.
- `Illuminate\Container\BindingResolutionException` has been moved to `Illuminate\Contracts\Container\BindingResolutionException`.
- The service container's `bindShared` method has been deprecated in favor of the `singleton` method.
- The Eloquent and query builder `pluck` method has been deprecated and renamed to `value`.
- The collection `fetch` method has been deprecated in favor of the `pluck` method.
- The `array_fetch` helper has been deprecated in favor of the `array_pluck` method.
</div>
<p><a name="upgrade-5.0.16"></a></p>
<h2 id="upgrading-to-5.0.16">Upgrading To 5.0.16</h2>
<p>In your <code>bootstrap/autoload.php</code> file, update the <code>$compiledPath</code> variable to:</p>
<pre><code>$compiledPath = __DIR__.&#39;/../vendor/compiled.php&#39;;</code></pre>
<h3 id="service-providers-1">Service Providers</h3>
<p>The <code>App\Providers\BusServiceProvider</code> may be removed from your service provider list in your <code>app.php</code> configuration file.</p>
<p>The <code>App\Providers\ConfigServiceProvider</code> may be removed from your service provider list in your <code>app.php</code> configuration file.</p>
<p><a name="upgrade-5.0"></a></p>
<h2 id="upgrading-to-5.0-from-4.2">Upgrading To 5.0 From 4.2</h2>
<h3 id="fresh-install-then-migrate">Fresh Install, Then Migrate</h3>
<p>The recommended method of upgrading is to create a new Laravel <code>5.0</code> install and then to copy your <code>4.2</code> site's unique application files into the new application. This would include controllers, routes, Eloquent models, Artisan commands, assets, and other code specific files to your application.</p>
<p>To start, <a href="/docs/5.0/installation">install a new Laravel 5.0 application</a> into a fresh directory in your local environment. Do not install any versions newer than 5.0 yet, since we need to complete the migration steps for 5.0 first. We'll discuss each piece of the migration process in further detail below.</p>
<h3 id="composer-dependencies-packages">Composer Dependencies &amp; Packages</h3>
<p>Don't forget to copy any additional Composer dependencies into your 5.0 application. This includes third-party code such as SDKs.</p>
<p>Some Laravel-specific packages may not be compatible with Laravel 5 on initial release. Check with your package's maintainer to determine the proper version of the package for Laravel 5. Once you have added any additional Composer dependencies your application needs, run <code>composer update</code>.</p>
<h3 id="namespacing">Namespacing</h3>
<p>By default, Laravel 4 applications did not utilize namespacing within your application code. So, for example, all Eloquent models and controllers simply lived in the &quot;global&quot; namespace. For a quicker migration, you can simply leave these classes in the global namespace in Laravel 5 as well.</p>
<h3 id="configuration-2">Configuration</h3>
<h4 id="migrating-environment-variables">Migrating Environment Variables</h4>
<p>Copy the new <code>.env.example</code> file to <code>.env</code>, which is the <code>5.0</code> equivalent of the old <code>.env.php</code> file. Set any appropriate values there, like your <code>APP_ENV</code> and <code>APP_KEY</code> (your encryption key), your database credentials, and your cache and session drivers.</p>
<p>Additionally, copy any custom values you had in your old <code>.env.php</code> file and place them in both <code>.env</code> (the real value for your local environment) and <code>.env.example</code> (a sample instructional value for other team members).</p>
<p>For more information on environment configuration, view the <a href="/docs/%7B%7Bversion%7D%7D/installation#environment-configuration">full documentation</a>.</p>
<blockquote>
<p>{note} You will need to place the appropriate <code>.env</code> file and values on your production server before deploying your Laravel 5 application.</p>
</blockquote>
<h4 id="configuration-files">Configuration Files</h4>
<p>Laravel 5.0 no longer uses <code>app/config/{environmentName}/</code> directories to provide specific configuration files for a given environment. Instead, move any configuration values that vary by environment into <code>.env</code>, and then access them in your configuration files using <code>env('key', 'default value')</code>. You will see examples of this in the <code>config/database.php</code> configuration file.</p>
<p>Set the config files in the <code>config/</code> directory to represent either the values that are consistent across all of your environments, or set them to use <code>env()</code> to load values that vary by environment.</p>
<p>Remember, if you add more keys to <code>.env</code> file, add sample values to the <code>.env.example</code> file as well. This will help your other team members create their own <code>.env</code> files.</p>
<h3 id="routes">Routes</h3>
<p>Copy and paste your old <code>routes.php</code> file into your new <code>app/Http/routes.php</code>.</p>
<h3 id="controllers-1">Controllers</h3>
<p>Next, move all of your controllers into the <code>app/Http/Controllers</code> directory. Since we are not going to migrate to full namespacing in this guide, add the <code>app/Http/Controllers</code> directory to the <code>classmap</code> directive of your <code>composer.json</code> file. Next, you can remove the namespace from the abstract <code>app/Http/Controllers/Controller.php</code> base class. Verify that your migrated controllers are extending this base class.</p>
<p>In your <code>app/Providers/RouteServiceProvider.php</code> file, set the <code>namespace</code> property to <code>null</code>.</p>
<h3 id="route-filters">Route Filters</h3>
<p>Copy your filter bindings from <code>app/filters.php</code> and place them into the <code>boot()</code> method of <code>app/Providers/RouteServiceProvider.php</code>. Add <code>use Illuminate\Support\Facades\Route;</code> in the <code>app/Providers/RouteServiceProvider.php</code> in order to continue using the <code>Route</code> Facade.</p>
<p>You do not need to move over any of the default Laravel 4.0 filters such as <code>auth</code> and <code>csrf</code>; they're all here, but as middleware. Edit any routes or controllers that reference the old default filters (e.g. <code>['before' =&gt; 'auth']</code>) and change them to reference the new middleware (e.g. <code>['middleware' =&gt; 'auth'].</code>)</p>
<p>Filters are not removed in Laravel 5. You can still bind and use your own custom filters using <code>before</code> and <code>after</code>.</p>
<h3 id="global-csrf">Global CSRF</h3>
<p>By default, <a href="/docs/%7B%7Bversion%7D%7D/routing#csrf-protection">CSRF protection</a> is enabled on all routes. If you'd like to disable this, or only manually enable it on certain routes, remove this line from <code>App\Http\Kernel</code>'s <code>middleware</code> array:</p>
<pre><code>&#39;App\Http\Middleware\VerifyCsrfToken&#39;,</code></pre>
<p>If you want to use it elsewhere, add this line to <code>$routeMiddleware</code>:</p>
<pre><code>&#39;csrf&#39; =&gt; &#39;App\Http\Middleware\VerifyCsrfToken&#39;,</code></pre>
<p>Now you can add the middleware to individual routes / controllers using <code>['middleware' =&gt; 'csrf']</code> on the route. For more information on middleware, consult the <a href="/docs/%7B%7Bversion%7D%7D/middleware">full documentation</a>.</p>
<h3 id="eloquent-models">Eloquent Models</h3>
<p>Feel free to create a new <code>app/Models</code> directory to house your Eloquent models. Again, add this directory to the <code>classmap</code> directive of your <code>composer.json</code> file.</p>
<p>Update any models using <code>SoftDeletingTrait</code> to use <code>Illuminate\Database\Eloquent\SoftDeletes</code>.</p>
<h4 id="eloquent-caching">Eloquent Caching</h4>
<p>Eloquent no longer provides the <code>remember</code> method for caching queries. You now are responsible for caching your queries manually using the <code>Cache::remember</code> function. For more information on caching, consult the <a href="/docs/%7B%7Bversion%7D%7D/cache">full documentation</a>.</p>
<h3 id="user-authentication-model">User Authentication Model</h3>
<p>To upgrade your <code>User</code> model for Laravel 5's authentication system, follow these instructions:</p>
<p><strong>Delete the following from your <code>use</code> block:</strong></p>
<div class="sourceCode"><pre class="sourceCode php"><code class="sourceCode php"><span class="kw">use</span> Illuminate\Auth\UserInterface<span class="ot">;</span>
<span class="kw">use</span> Illuminate\Auth\Reminders\RemindableInterface<span class="ot">;</span></code></pre></div>
<p><strong>Add the following to your <code>use</code> block:</strong></p>
<div class="sourceCode"><pre class="sourceCode php"><code class="sourceCode php"><span class="kw">use</span> Illuminate\Auth\Authenticatable<span class="ot">;</span>
<span class="kw">use</span> Illuminate\Auth\Passwords\CanResetPassword<span class="ot">;</span>
<span class="kw">use</span> Illuminate\Contracts\Auth\Authenticatable <span class="kw">as</span> AuthenticatableContract<span class="ot">;</span>
<span class="kw">use</span> Illuminate\Contracts\Auth\CanResetPassword <span class="kw">as</span> CanResetPasswordContract<span class="ot">;</span></code></pre></div>
<p><strong>Remove the UserInterface and RemindableInterface interfaces.</strong></p>
<p><strong>Mark the class as implementing the following interfaces:</strong></p>
<div class="sourceCode"><pre class="sourceCode php"><code class="sourceCode php"><span class="kw">implements</span> AuthenticatableContract<span class="ot">,</span> CanResetPasswordContract</code></pre></div>
<p><strong>Include the following traits within the class declaration:</strong></p>
<div class="sourceCode"><pre class="sourceCode php"><code class="sourceCode php"><span class="kw">use</span> Authenticatable<span class="ot">,</span> CanResetPassword<span class="ot">;</span></code></pre></div>
<p><strong>If you used them, remove <code>Illuminate\Auth\Reminders\RemindableTrait</code> and <code>Illuminate\Auth\UserTrait</code> from your use block and your class declaration.</strong></p>
<h3 id="cashier-user-changes">Cashier User Changes</h3>
<p>The name of the trait and interface used by <a href="/docs/%7B%7Bversion%7D%7D/billing">Laravel Cashier</a> has changed. Instead of using <code>BillableTrait</code>, use the <code>Laravel\Cashier\Billable</code> trait. And, instead of <code>Laravel\Cashier\BillableInterface</code> implement the <code>Laravel\Cashier\Contracts\Billable</code> interface instead. No other method changes are required.</p>
<h3 id="artisan-commands">Artisan Commands</h3>
<p>Move all of your command classes from your old <code>app/commands</code> directory to the new <code>app/Console/Commands</code> directory. Next, add the <code>app/Console/Commands</code> directory to the <code>classmap</code> directive of your <code>composer.json</code> file.</p>
<p>Then, copy your list of Artisan commands from <code>start/artisan.php</code> into the <code>commands</code> array of the <code>app/Console/Kernel.php</code> file.</p>
<h3 id="database-migrations-seeds">Database Migrations &amp; Seeds</h3>
<p>Delete the two migrations included with Laravel 5.0, since you should already have the users table in your database.</p>
<p>Move all of your migration classes from the old <code>app/database/migrations</code> directory to the new <code>database/migrations</code>. All of your seeds should be moved from <code>app/database/seeds</code> to <code>database/seeds</code>.</p>
<h3 id="global-ioc-bindings">Global IoC Bindings</h3>
<p>If you have any <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> bindings in <code>start/global.php</code>, move them all to the <code>register</code> method of the <code>app/Providers/AppServiceProvider.php</code> file. You may need to import the <code>App</code> facade.</p>
<p>Optionally, you may break these bindings up into separate service providers by category.</p>
<h3 id="views">Views</h3>
<p>Move your views from <code>app/views</code> to the new <code>resources/views</code> directory.</p>
<h3 id="blade-tag-changes">Blade Tag Changes</h3>
<p>For better security by default, Laravel 5.0 escapes all output from both the <code>{{ }}</code> and <code>{{{ }}}</code> Blade directives. A new <code>{!! !!}</code> directive has been introduced to display raw, unescaped output. The most secure option when upgrading your application is to only use the new <code>{!! !!}</code> directive when you are <strong>certain</strong> that it is safe to display raw output.</p>
<p>However, if you <strong>must</strong> use the old Blade syntax, add the following lines at the bottom of <code>AppServiceProvider@register</code>:</p>
<div class="sourceCode"><pre class="sourceCode php"><code class="sourceCode php">\Blade::setRawTags<span class="ot">(</span><span class="st">&#39;{{&#39;</span><span class="ot">,</span> <span class="st">&#39;}}&#39;</span><span class="ot">);</span>
\Blade::setContentTags<span class="ot">(</span><span class="st">&#39;{{{&#39;</span><span class="ot">,</span> <span class="st">&#39;}}}&#39;</span><span class="ot">);</span>
\Blade::setEscapedContentTags<span class="ot">(</span><span class="st">&#39;{{{&#39;</span><span class="ot">,</span> <span class="st">&#39;}}}&#39;</span><span class="ot">);</span></code></pre></div>
<p>This should not be done lightly, and may make your application more vulnerable to XSS exploits. Also, comments with <code>{{--</code> will no longer work.</p>
<h3 id="translation-files-1">Translation Files</h3>
<p>Move your language files from <code>app/lang</code> to the new <code>resources/lang</code> directory.</p>
<h3 id="public-directory">Public Directory</h3>
<p>Copy your application's public assets from your <code>4.2</code> application's <code>public</code> directory to your new application's <code>public</code> directory. Be sure to keep the <code>5.0</code> version of <code>index.php</code>.</p>
<h3 id="tests-1">Tests</h3>
<p>Move your tests from <code>app/tests</code> to the new <code>tests</code> directory.</p>
<h3 id="misc.-files">Misc. Files</h3>
<p>Copy in any other files in your project. For example, <code>.scrutinizer.yml</code>, <code>bower.json</code> and other similar tooling configuration files.</p>
<p>You may move your Sass, Less, or CoffeeScript to any location you wish. The <code>resources/assets</code> directory could be a good default location.</p>
<h3 id="form-html-helpers">Form &amp; HTML Helpers</h3>
<p>If you're using Form or HTML helpers, you will see an error stating <code>class 'Form' not found</code> or <code>class 'Html' not found</code>. The Form and HTML helpers have been deprecated in Laravel 5.0; however, there are community-driven replacements such as those maintained by the <a href="http://laravelcollective.com/docs/%7B%7Bversion%7D%7D/html">Laravel Collective</a>.</p>
<p>For example, you may add <code>&quot;laravelcollective/html&quot;: &quot;~5.0&quot;</code> to your <code>composer.json</code> file's <code>require</code> section.</p>
<p>You'll also need to add the Form and HTML facades and service provider. Edit <code>config/app.php</code> and add this line to the 'providers' array:</p>
<pre><code>&#39;Collective\Html\HtmlServiceProvider&#39;,</code></pre>
<p>Next, add these lines to the 'aliases' array:</p>
<pre><code>&#39;Form&#39; =&gt; &#39;Collective\Html\FormFacade&#39;,
&#39;Html&#39; =&gt; &#39;Collective\Html\HtmlFacade&#39;,</code></pre>
<h3 id="cachemanager">CacheManager</h3>
<p>If your application code was injecting <code>Illuminate\Cache\CacheManager</code> to get a non-Facade version of Laravel's cache, inject <code>Illuminate\Contracts\Cache\Repository</code> instead.</p>
<h3 id="pagination-2">Pagination</h3>
<p>Replace any calls to <code>$paginator-&gt;links()</code> with <code>$paginator-&gt;render()</code>.</p>
<p>Replace any calls to <code>$paginator-&gt;getFrom()</code> and <code>$paginator-&gt;getTo()</code> with <code>$paginator-&gt;firstItem()</code> and <code>$paginator-&gt;lastItem()</code> respectively.</p>
<p>Remove the &quot;get&quot; prefix from calls to <code>$paginator-&gt;getPerPage()</code>, <code>$paginator-&gt;getCurrentPage()</code>, <code>$paginator-&gt;getLastPage()</code> and <code>$paginator-&gt;getTotal()</code> (e.g. <code>$paginator-&gt;perPage()</code>).</p>
<h3 id="beanstalk-queuing">Beanstalk Queuing</h3>
<p>Laravel 5.0 now requires <code>&quot;pda/pheanstalk&quot;: &quot;~3.0&quot;</code> instead of <code>&quot;pda/pheanstalk&quot;: &quot;~2.1&quot;</code>.</p>
<h3 id="remote">Remote</h3>
<p>The Remote component has been deprecated.</p>
<h3 id="workbench">Workbench</h3>
<p>The Workbench component has been deprecated.</p>
<p><a name="upgrade-4.2"></a></p>
<h2 id="upgrading-to-4.2-from-4.1">Upgrading To 4.2 From 4.1</h2>
<h3 id="php-5.4">PHP 5.4+</h3>
<p>Laravel 4.2 requires PHP 5.4.0 or greater.</p>
<h3 id="encryption-defaults">Encryption Defaults</h3>
<p>Add a new <code>cipher</code> option in your <code>app/config/app.php</code> configuration file. The value of this option should be <code>MCRYPT_RIJNDAEL_256</code>.</p>
<pre><code>&#39;cipher&#39; =&gt; MCRYPT_RIJNDAEL_256</code></pre>
<p>This setting may be used to control the default cipher used by the Laravel encryption facilities.</p>
<blockquote>
<p>{note} In Laravel 4.2, the default cipher is <code>MCRYPT_RIJNDAEL_128</code> (AES), which is considered to be the most secure cipher. Changing the cipher back to <code>MCRYPT_RIJNDAEL_256</code> is required to decrypt cookies/values that were encrypted in Laravel &lt;= 4.1</p>
</blockquote>
<h3 id="soft-deleting-models-now-use-traits">Soft Deleting Models Now Use Traits</h3>
<p>If you are using soft deleting models, the <code>softDeletes</code> property has been removed. You must now use the <code>SoftDeletingTrait</code> like so:</p>
<pre><code>use Illuminate\Database\Eloquent\SoftDeletingTrait;

class User extends Eloquent
{
    use SoftDeletingTrait;
}</code></pre>
<p>You must also manually add the <code>deleted_at</code> column to your <code>dates</code> property:</p>
<pre><code>class User extends Eloquent
{
    use SoftDeletingTrait;

    protected $dates = [&#39;deleted_at&#39;];
}</code></pre>
<p>The API for all soft delete operations remains the same.</p>
<blockquote>
<p>{note} The <code>SoftDeletingTrait</code> can not be applied on a base model. It must be used on an actual model class.</p>
</blockquote>
<h3 id="view-pagination-environment-renamed">View / Pagination Environment Renamed</h3>
<p>If you are directly referencing the <code>Illuminate\View\Environment</code> class or <code>Illuminate\Pagination\Environment</code> class, update your code to reference <code>Illuminate\View\Factory</code> and <code>Illuminate\Pagination\Factory</code> instead. These two classes have been renamed to better reflect their function.</p>
<h3 id="additional-parameter-on-pagination-presenter">Additional Parameter On Pagination Presenter</h3>
<p>If you are extending the <code>Illuminate\Pagination\Presenter</code> class, the abstract method <code>getPageLinkWrapper</code> signature has changed to add the <code>rel</code> argument:</p>
<pre><code>abstract public function getPageLinkWrapper($url, $page, $rel = null);</code></pre>
<h3 id="iron.io-queue-encryption">Iron.Io Queue Encryption</h3>
<p>If you are using the Iron.io queue driver, you will need to add a new <code>encrypt</code> option to your queue configuration file:</p>
<pre><code>&#39;encrypt&#39; =&gt; true</code></pre>
<p><a name="upgrade-4.1.29"></a></p>
<h2 id="upgrading-to-4.1.29-from-4.1.x">Upgrading To 4.1.29 From &lt;= 4.1.x</h2>
<p>Laravel 4.1.29 improves the column quoting for all database drivers. This protects your application from some mass assignment vulnerabilities when <strong>not</strong> using the <code>fillable</code> property on models. If you are using the <code>fillable</code> property on your models to protect against mass assignment, your application is not vulnerable. However, if you are using <code>guarded</code> and are passing a user controlled array into an &quot;update&quot; or &quot;save&quot; type function, you should upgrade to <code>4.1.29</code> immediately as your application may be at risk of mass assignment.</p>
<p>To upgrade to Laravel 4.1.29, simply <code>composer update</code>. No breaking changes are introduced in this release.</p>
<p><a name="upgrade-4.1.26"></a></p>
<h2 id="upgrading-to-4.1.26-from-4.1.25">Upgrading To 4.1.26 From &lt;= 4.1.25</h2>
<p>Laravel 4.1.26 introduces security improvements for &quot;remember me&quot; cookies. Before this update, if a remember cookie was hijacked by another malicious user, the cookie would remain valid for a long period of time, even after the true owner of the account reset their password, logged out, etc.</p>
<p>This change requires the addition of a new <code>remember_token</code> column to your <code>users</code> (or equivalent) database table. After this change, a fresh token will be assigned to the user each time they login to your application. The token will also be refreshed when the user logs out of the application. The implications of this change are: if a &quot;remember me&quot; cookie is hijacked, simply logging out of the application will invalidate the cookie.</p>
<h3 id="upgrade-path">Upgrade Path</h3>
<p>First, add a new, nullable <code>remember_token</code> of VARCHAR(100), TEXT, or equivalent to your <code>users</code> table.</p>
<p>Next, if you are using the Eloquent authentication driver, update your <code>User</code> class with the following three methods:</p>
<pre><code>public function getRememberToken()
{
    return $this-&gt;remember_token;
}

public function setRememberToken($value)
{
    $this-&gt;remember_token = $value;
}

public function getRememberTokenName()
{
    return &#39;remember_token&#39;;
}</code></pre>
<blockquote>
<p>{note} All existing &quot;remember me&quot; sessions will be invalidated by this change, so all users will be forced to re-authenticate with your application.</p>
</blockquote>
<h3 id="package-maintainers">Package Maintainers</h3>
<p>Two new methods were added to the <code>Illuminate\Auth\UserProviderInterface</code> interface. Sample implementations may be found in the default drivers:</p>
<pre><code>public function retrieveByToken($identifier, $token);

public function updateRememberToken(UserInterface $user, $token);</code></pre>
<p>The <code>Illuminate\Auth\UserInterface</code> also received the three new methods described in the &quot;Upgrade Path&quot;.</p>
<p><a name="upgrade-4.1"></a></p>
<h2 id="upgrading-to-4.1-from-4.0">Upgrading To 4.1 From 4.0</h2>
<h3 id="upgrading-your-composer-dependency">Upgrading Your Composer Dependency</h3>
<p>To upgrade your application to Laravel 4.1, change your <code>laravel/framework</code> version to <code>4.1.*</code> in your <code>composer.json</code> file.</p>
<h3 id="replacing-files">Replacing Files</h3>
<p>Replace your <code>public/index.php</code> file with <a href="https://github.com/laravel/laravel/blob/v4.1.0/public/index.php">this fresh copy from the repository</a>.</p>
<p>Replace your <code>artisan</code> file with <a href="https://github.com/laravel/laravel/blob/v4.1.0/artisan">this fresh copy from the repository</a>.</p>
<h3 id="adding-configuration-files-options">Adding Configuration Files &amp; Options</h3>
<p>Update your <code>aliases</code> and <code>providers</code> arrays in your <code>app/config/app.php</code> configuration file. The updated values for these arrays can be found <a href="https://github.com/laravel/laravel/blob/v4.1.0/app/config/app.php">in this file</a>. Be sure to add your custom and package service providers / aliases back to the arrays.</p>
<p>Add the new <code>app/config/remote.php</code> file <a href="https://github.com/laravel/laravel/blob/v4.1.0/app/config/remote.php">from the repository</a>.</p>
<p>Add the new <code>expire_on_close</code> configuration option to your <code>app/config/session.php</code> file. The default value should be <code>false</code>.</p>
<p>Add the new <code>failed</code> configuration section to your <code>app/config/queue.php</code> file. Here are the default values for the section:</p>
<pre><code>&#39;failed&#39; =&gt; [
    &#39;database&#39; =&gt; &#39;mysql&#39;, &#39;table&#39; =&gt; &#39;failed_jobs&#39;,
],</code></pre>
<p><strong>(Optional)</strong> Update the <code>pagination</code> configuration option in your <code>app/config/view.php</code> file to <code>pagination::slider-3</code>.</p>
<h3 id="controller-updates">Controller Updates</h3>
<p>If <code>app/controllers/BaseController.php</code> has a <code>use</code> statement at the top, change <code>use Illuminate\Routing\Controllers\Controller;</code> to <code>use Illuminate\Routing\Controller;</code>.</p>
<h3 id="password-reminders-updates">Password Reminders Updates</h3>
<p>Password reminders have been overhauled for greater flexibility. You may examine the new stub controller by running the <code>php artisan auth:reminders-controller</code> Artisan command. You may also browse the <a href="/docs/security#password-reminders-and-reset">updated documentation</a> and update your application accordingly.</p>
<p>Update your <code>app/lang/en/reminders.php</code> language file to match <a href="https://github.com/laravel/laravel/blob/v4.1.0/app/lang/en/reminders.php">this updated file</a>.</p>
<h3 id="environment-detection-updates">Environment Detection Updates</h3>
<p>For security reasons, URL domains may no longer be used to detect your application environment. These values are easily spoofable and allow attackers to modify the environment for a request. You should convert your environment detection to use machine host names (<code>hostname</code> command on Mac, Linux, and Windows).</p>
<h3 id="simpler-log-files">Simpler Log Files</h3>
<p>Laravel now generates a single log file: <code>app/storage/logs/laravel.log</code>. However, you may still configure this behavior in your <code>app/start/global.php</code> file.</p>
<h3 id="removing-redirect-trailing-slash">Removing Redirect Trailing Slash</h3>
<p>In your <code>bootstrap/start.php</code> file, remove the call to <code>$app-&gt;redirectIfTrailingSlash()</code>. This method is no longer needed as this functionality is now handled by the <code>.htaccess</code> file included with the framework.</p>
<p>Next, replace your Apache <code>.htaccess</code> file with <a href="https://github.com/laravel/laravel/blob/v4.1.0/public/.htaccess">this new one</a> that handles trailing slashes.</p>
<h3 id="current-route-access">Current Route Access</h3>
<p>The current route is now accessed via <code>Route::current()</code> instead of <code>Route::getCurrentRoute()</code>.</p>
<h3 id="composer-update">Composer Update</h3>
<p>Once you have completed the changes above, you can run the <code>composer update</code> function to update your core application files! If you receive class load errors, try running the <code>update</code> command with the <code>--no-scripts</code> option enabled like so: <code>composer update --no-scripts</code>.</p>
<h3 id="wildcard-event-listeners">Wildcard Event Listeners</h3>
<p>The wildcard event listeners no longer append the event to your handler functions parameters. If you require finding the event that was fired you should use <code>Event::firing()</code>.</p>
</article>
</body>
</html>
